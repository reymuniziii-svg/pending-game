import type { GameEvent, EventChain } from '@/types'

// ============ ELENA UNDOCUMENTED DEEP DECISION CHAINS ============
// V2: Deep branching narratives with 4-8 event depth

export const ELENA_CHAIN_EVENTS: GameEvent[] = [
  // === CHAIN 1: THE WAIVER PATH (8 events deep) ===
  {
    id: 'elena_chain_waiver_start',
    title: 'The Lawyer\'s Assessment',
    description: 'Michael found an immigration lawyer who specializes in unlawful presence waivers. You sit in her office, Michael holding your hand, while she reviews your case.',
    sceneType: 'work',
    interruptPriority: 'important',
    timing: { type: 'random', earliestMonth: 12, latestMonth: 48 },
    conditions: [
      { type: 'character', target: 'id', operator: '==', value: 'elena' },
      { type: 'flag', target: 'waiver_consultation_started', operator: 'not-exists', value: true },
    ],
    weight: 60,
    characterIds: ['elena'],
    chainId: 'elena_waiver_path',
    chainPosition: 1,
    isChainStart: true,
    choices: [
      {
        id: 'hear_options',
        text: 'Ask about your options',
        costs: [{ type: 'money', amount: 250, description: 'Consultation fee' }],
        outcomes: [
          { type: 'finance-subtract', target: 'Immigration Consultation', value: 250 },
          { type: 'flag-set', target: 'waiver_consultation_started', value: true },
          { type: 'stat-change', target: 'stress', value: 20 },
        ],
        outcomeText: 'The lawyer pulls out a whiteboard. "You entered without inspection. That means adjustment of status isn\'t available. But there\'s a path: the I-601A waiver. We have to prove Michael would suffer extreme hardship without you."',
        nextEventId: 'elena_chain_waiver_explained',
      },
    ],
    tags: ['immigration', 'legal', 'waiver', 'family'],
    isRepeatable: false,
    isMandatory: false,
    priority: 8,
  },
  {
    id: 'elena_chain_waiver_explained',
    title: 'The Catch-22',
    description: '"Let me explain the catch," the lawyer says. "To get your green card, you need to interview at a consulate in Mexico. But when you leave, you trigger a 10-year bar. The waiver asks forgiveness for that bar—but there\'s no guarantee."',
    sceneType: 'work',
    interruptPriority: 'critical',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['elena'],
    chainId: 'elena_waiver_path',
    chainPosition: 2,
    choices: [
      {
        id: 'pursue_waiver',
        text: 'Pursue the I-601A waiver path',
        costs: [{ type: 'money', amount: 3500, description: 'Waiver preparation retainer' }],
        outcomes: [
          { type: 'finance-subtract', target: 'I-601A Retainer', value: 3500 },
          { type: 'flag-set', target: 'pursuing_waiver', value: true },
          { type: 'stat-change', target: 'stress', value: 25 },
        ],
        outcomeText: '"It\'s risky," Michael says later. "But it\'s our only real option." The lawyer begins gathering evidence: Michael\'s medical records, your children\'s school records, letters from your community.',
        nextEventId: 'elena_chain_building_case',
      },
      {
        id: 'stay_undocumented',
        text: 'The risk is too high—stay as you are',
        outcomes: [
          { type: 'flag-set', target: 'chose_status_quo', value: true },
          { type: 'stat-change', target: 'stress', value: 15 },
        ],
        outcomeText: '"If the waiver is denied, I\'d be stuck in Mexico," you say. Michael nods slowly. "We\'ll figure something else out." But you both know there is nothing else. Just more years of living in the shadows.',
        nextEventId: 'elena_chain_status_quo_life',
      },
    ],
    tags: ['immigration', 'decision', 'risk', 'family'],
    isRepeatable: false,
    isMandatory: false,
    priority: 9,
  },
  {
    id: 'elena_chain_building_case',
    title: 'Building the Hardship Case',
    description: 'For the waiver to succeed, you must prove that Michael—an American citizen—would face "extreme hardship" if you\'re not allowed to return. Not just sadness. Not just inconvenience. Extreme hardship.',
    sceneType: 'home',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['elena'],
    chainId: 'elena_waiver_path',
    chainPosition: 3,
    choices: [
      {
        id: 'psychological_eval',
        text: 'Get a psychological evaluation for Michael',
        costs: [{ type: 'money', amount: 800, description: 'Psychological evaluation' }],
        outcomes: [
          { type: 'finance-subtract', target: 'Psych Evaluation', value: 800 },
          { type: 'flag-set', target: 'has_psych_eval', value: true },
          { type: 'stat-change', target: 'stress', value: 10 },
          { type: 'relationship-change', target: 'michael', value: -5 },
        ],
        outcomeText: 'A psychologist documents Michael\'s anxiety, his dependence on your partnership, how separation would impact his mental health. Michael feels uncomfortable being examined, but he does it for you.',
        nextEventId: 'elena_chain_waiver_submission',
        isRecommended: true,
      },
      {
        id: 'financial_evidence',
        text: 'Focus on financial evidence only',
        outcomes: [
          { type: 'flag-set', target: 'financial_evidence_only', value: true },
          { type: 'stat-change', target: 'stress', value: 15 },
        ],
        outcomeText: 'Bank statements. Tax returns. Your income contribution to the household. The lawyer looks concerned. "Financial hardship alone is rarely enough to prove extreme hardship."',
        nextEventId: 'elena_chain_waiver_submission',
      },
    ],
    tags: ['immigration', 'evidence', 'family'],
    isRepeatable: false,
    isMandatory: false,
    priority: 7,
  },
  {
    id: 'elena_chain_waiver_submission',
    title: 'The Submission',
    description: 'The waiver packet is ready: 300 pages documenting your life, your love, your children\'s needs, Michael\'s hardship. The lawyer weighs it in her hands.',
    sceneType: 'uscis',
    interruptPriority: 'important',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['elena'],
    chainId: 'elena_waiver_path',
    chainPosition: 4,
    choices: [
      {
        id: 'submit_waiver',
        text: 'Submit the I-601A waiver',
        costs: [{ type: 'money', amount: 630, description: 'I-601A filing fee' }],
        outcomes: [
          { type: 'finance-subtract', target: 'I-601A Filing Fee', value: 630 },
          { type: 'flag-set', target: 'waiver_submitted', value: true },
          { type: 'stat-change', target: 'stress', value: 30 },
          { type: 'file-application', target: 'i-601a', value: true },
        ],
        outcomeText: 'You watch the FedEx truck take the envelope. Your future is now in the hands of USCIS. Processing time: 15-24 months. You learn to function while waiting for your life to be decided.',
        nextEventId: 'elena_chain_waiver_wait',
      },
    ],
    tags: ['immigration', 'uscis', 'submission'],
    isRepeatable: false,
    isMandatory: false,
    priority: 8,
  },
  {
    id: 'elena_chain_waiver_wait',
    title: 'The Long Wait',
    description: 'A year passes. Your children grow. Sofia starts middle school. Diego loses his first tooth. Life continues while your waiver sits in a government building somewhere.',
    sceneType: 'home',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['elena'],
    chainId: 'elena_waiver_path',
    chainPosition: 5,
    choices: [
      {
        id: 'live_normally',
        text: 'Try to live normally while waiting',
        outcomes: [
          { type: 'stat-change', target: 'stress', value: 10 },
          { type: 'flag-set', target: 'waited_patiently', value: true },
        ],
        outcomeText: 'You go to work. Make dinner. Help with homework. Every day a small act of faith that there will be a tomorrow here. The case status never changes: "Case is being actively reviewed."',
        nextEventId: 'elena_chain_waiver_decision',
        isRecommended: true,
      },
      {
        id: 'consumed_by_waiting',
        text: 'The waiting consumes everything',
        outcomes: [
          { type: 'stat-change', target: 'stress', value: 30 },
          { type: 'stat-change', target: 'health', value: -10 },
        ],
        outcomeText: 'You check the case status every day. Sometimes twice. Your sleep suffers. Michael worries. The children notice mommy is different now. You can\'t explain that you\'re waiting to know if you can stay.',
        nextEventId: 'elena_chain_waiver_decision',
      },
    ],
    tags: ['waiting', 'life', 'family'],
    isRepeatable: false,
    isMandatory: false,
    priority: 5,
  },
  {
    id: 'elena_chain_waiver_decision',
    title: 'The Decision',
    description: 'Eighteen months after submission. The lawyer calls. "Elena, we have a decision."',
    sceneType: 'home',
    interruptPriority: 'critical',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['elena'],
    chainId: 'elena_waiver_path',
    chainPosition: 6,
    variants: [
      {
        condition: { type: 'flag', target: 'has_psych_eval', operator: '==', value: true },
        descriptionOverride: 'Eighteen months after submission. The lawyer calls, her voice carefully neutral. "Elena, we have a decision. It\'s good news."',
      },
    ],
    choices: [
      {
        id: 'waiver_approved',
        text: 'What does it say?',
        requirements: [{ type: 'flag', target: 'has_psych_eval', operator: '==', value: true }],
        outcomes: [
          { type: 'flag-set', target: 'waiver_approved', value: true },
          { type: 'stat-change', target: 'stress', value: -30 },
        ],
        outcomeText: '"Approved. Your I-601A waiver is approved." You sink to the floor. Michael catches you. The children stare. "Mommy, why are you crying?" "Good tears, mijo. These are good tears."',
        nextEventId: 'elena_chain_consular_trip',
      },
      {
        id: 'waiver_denied',
        text: 'What does it say?',
        requirements: [{ type: 'flag', target: 'financial_evidence_only', operator: '==', value: true }],
        outcomes: [
          { type: 'flag-set', target: 'waiver_denied', value: true },
          { type: 'stat-change', target: 'stress', value: 50 },
        ],
        outcomeText: '"Denied. They didn\'t find sufficient evidence of extreme hardship." The room spins. $5,000 in fees. Eighteen months of hope. Nothing. "We can try again with more evidence," the lawyer says. But you both know.',
        nextEventId: 'elena_chain_after_denial',
        probability: 0.6,
      },
      {
        id: 'waiver_approved_marginal',
        text: 'What does it say?',
        outcomes: [
          { type: 'flag-set', target: 'waiver_approved', value: true },
          { type: 'stat-change', target: 'stress', value: -20 },
        ],
        outcomeText: '"Approved—but it was close. The officer found the case marginal." Relief overwhelms caution. Approved is approved. The next step is the consular interview in Mexico.',
        nextEventId: 'elena_chain_consular_trip',
        probability: 0.4,
      },
    ],
    tags: ['immigration', 'decision', 'critical', 'climax'],
    isRepeatable: false,
    isMandatory: false,
    priority: 10,
  },
  {
    id: 'elena_chain_consular_trip',
    title: 'Going Back',
    description: 'With the waiver approved, you must travel to Ciudad Juárez for your immigrant visa interview. You haven\'t been to Mexico in 13 years. You will return as a visitor to the country that was once home.',
    sceneType: 'airport',
    interruptPriority: 'critical',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['elena'],
    chainId: 'elena_waiver_path',
    chainPosition: 7,
    choices: [
      {
        id: 'go_alone',
        text: 'Travel to Mexico alone',
        costs: [{ type: 'money', amount: 1500, description: 'Travel and lodging' }],
        outcomes: [
          { type: 'finance-subtract', target: 'Consular Trip', value: 1500 },
          { type: 'flag-set', target: 'went_to_mexico', value: true },
          { type: 'stat-change', target: 'stress', value: 30 },
        ],
        outcomeText: 'At the airport, you hold your children so tight they squirm. "I\'ll be back in a few days," you promise. "With papers." They don\'t understand what papers mean. They just know mommy is leaving.',
        nextEventId: 'elena_chain_consular_interview',
      },
      {
        id: 'michael_comes',
        text: 'Michael insists on accompanying you',
        costs: [{ type: 'money', amount: 2500, description: 'Travel and childcare' }],
        outcomes: [
          { type: 'finance-subtract', target: 'Trip with Michael', value: 2500 },
          { type: 'flag-set', target: 'went_to_mexico', value: true },
          { type: 'flag-set', target: 'michael_at_interview', value: true },
          { type: 'stat-change', target: 'stress', value: 20 },
          { type: 'relationship-change', target: 'michael', value: 10 },
        ],
        outcomeText: '"I\'m not letting you face this alone." Michael\'s parents watch the kids. On the plane, he holds your hand. "Whatever happens, we face it together."',
        nextEventId: 'elena_chain_consular_interview',
        isRecommended: true,
      },
    ],
    tags: ['travel', 'mexico', 'family', 'critical'],
    isRepeatable: false,
    isMandatory: false,
    priority: 10,
  },
  {
    id: 'elena_chain_consular_interview',
    title: 'The Interview',
    description: 'The US Consulate in Ciudad Juárez. A building that decides fates. You wait in line with hundreds of others, all hoping for the same thing.',
    sceneType: 'uscis',
    interruptPriority: 'critical',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['elena'],
    chainId: 'elena_waiver_path',
    chainPosition: 8,
    choices: [
      {
        id: 'interview_goes_well',
        text: 'The officer calls you forward...',
        outcomes: [
          { type: 'status-change', target: 'i485-pending', value: true },
          { type: 'flag-set', target: 'visa_approved', value: true },
          { type: 'stat-change', target: 'stress', value: -50 },
        ],
        outcomeText: 'Questions about your children. Your marriage. Your life in America. The officer stamps something. "Your visa is approved. You can pick up your passport tomorrow." Thirteen years of shadows. Over.',
        probability: 0.9,
      },
      {
        id: 'administrative_processing',
        text: 'The officer calls you forward...',
        outcomes: [
          { type: 'flag-set', target: 'admin_processing', value: true },
          { type: 'stat-change', target: 'stress', value: 40 },
        ],
        outcomeText: '"Your case requires additional administrative processing." No timeline. No explanation. You\'re stuck in Mexico, away from your children, waiting for a bureaucracy to decide your fate.',
        probability: 0.1,
      },
    ],
    tags: ['interview', 'visa', 'critical', 'climax'],
    isRepeatable: false,
    isMandatory: false,
    priority: 10,
  },

  // === CHAIN 2: THE CHILDREN'S DILEMMA (5 events deep) ===
  {
    id: 'elena_chain_children_question_start',
    title: 'The Uncomfortable Question',
    description: '"Mommy, why can\'t you come to my school field trip?" Sofia asks. "Other mommies are going." She\'s too young to understand why you can\'t risk being on a bus that might be stopped.',
    sceneType: 'home',
    timing: { type: 'random', earliestMonth: 6, latestMonth: 24 },
    conditions: [
      { type: 'character', target: 'id', operator: '==', value: 'elena' },
      { type: 'flag', target: 'children_question_started', operator: 'not-exists', value: true },
    ],
    weight: 55,
    characterIds: ['elena'],
    chainId: 'elena_children_dilemma',
    chainPosition: 1,
    isChainStart: true,
    choices: [
      {
        id: 'make_excuse',
        text: 'Make an excuse—work, headache, anything',
        outcomes: [
          { type: 'flag-set', target: 'children_question_started', value: true },
          { type: 'flag-set', target: 'hiding_truth_from_children', value: true },
          { type: 'stat-change', target: 'stress', value: 15 },
        ],
        outcomeText: '"Mommy has to work, mi amor." Sofia\'s face falls. You\'ve missed three field trips now. Soon she\'ll stop asking. That thought hurts worse than the lie.',
        nextEventId: 'elena_chain_children_growing',
      },
      {
        id: 'partial_truth',
        text: 'Tell a version of the truth',
        outcomes: [
          { type: 'flag-set', target: 'children_question_started', value: true },
          { type: 'flag-set', target: 'told_children_partially', value: true },
          { type: 'stat-change', target: 'stress', value: 20 },
        ],
        outcomeText: '"Mommy has a special situation with papers that makes it hard to do certain things." Sofia frowns, trying to understand. "Like permission slips?" "Yes, baby. Exactly like that."',
        nextEventId: 'elena_chain_sofia_understands',
      },
    ],
    tags: ['children', 'family', 'secrets', 'emotional'],
    isRepeatable: false,
    isMandatory: false,
    priority: 6,
  },
  {
    id: 'elena_chain_children_growing',
    title: 'Growing Up Too Fast',
    description: 'Sofia is 10 now. She\'s heard things at school. "Alejandro said some people are illegal. What does that mean, Mommy?"',
    sceneType: 'home',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['elena'],
    chainId: 'elena_children_dilemma',
    chainPosition: 2,
    choices: [
      {
        id: 'age_appropriate_truth',
        text: 'Explain in age-appropriate terms',
        outcomes: [
          { type: 'flag-set', target: 'told_children_truth', value: true },
          { type: 'stat-change', target: 'stress', value: 25 },
          { type: 'stat-change', target: 'communityConnection', value: 10 },
        ],
        outcomeText: 'You sit her down. Explain that some people come to America without the right papers. That you\'re one of those people. That she and Diego were born here, so they\'re citizens. Her eyes go wide. "Could they take you away?"',
        nextEventId: 'elena_chain_children_know',
      },
      {
        id: 'deflect',
        text: 'Change the subject',
        outcomes: [
          { type: 'stat-change', target: 'stress', value: 15 },
          { type: 'relationship-change', target: 'sofia', value: -5 },
        ],
        outcomeText: '"That\'s a complicated grown-up topic, mija. Let\'s talk about your homework." Sofia\'s face closes. She\'s learning that there are questions mommy won\'t answer.',
        nextEventId: 'elena_chain_sofia_distance',
      },
    ],
    tags: ['children', 'truth', 'family'],
    isRepeatable: false,
    isMandatory: false,
    priority: 6,
  },
  {
    id: 'elena_chain_children_know',
    title: 'The Weight They Carry',
    description: 'Sofia now knows. She\'s started being careful about what she says to friends. Diego notices his sister is different and wonders why.',
    sceneType: 'home',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['elena'],
    chainId: 'elena_children_dilemma',
    chainPosition: 3,
    choices: [
      {
        id: 'reassure_children',
        text: 'Reassure them that you\'re working on it',
        outcomes: [
          { type: 'stat-change', target: 'stress', value: 10 },
          { type: 'relationship-change', target: 'sofia', value: 5 },
        ],
        outcomeText: '"Daddy and I are working with a lawyer. We\'re trying to fix it." Sofia nods, older than her years. "I won\'t tell anyone, Mommy. I promise." A child shouldn\'t carry adult secrets.',
        isRecommended: true,
      },
      {
        id: 'let_michael_handle',
        text: 'Let Michael handle the explanations',
        outcomes: [
          { type: 'stat-change', target: 'stress', value: 5 },
          { type: 'relationship-change', target: 'michael', value: 5 },
        ],
        outcomeText: 'Michael sits with both kids. As a citizen, as their father, his explanation feels safer somehow. "Mommy came here a different way than most people. We\'re working on making it official."',
      },
    ],
    tags: ['children', 'family', 'truth'],
    isRepeatable: false,
    isMandatory: false,
    priority: 5,
  },
  {
    id: 'elena_chain_sofia_understands',
    title: 'Sofia\'s Awareness',
    description: 'Years later, Sofia truly understands. She\'s doing a school project on immigration and asks to interview you. "I want to tell your story, Mommy. So people understand."',
    sceneType: 'home',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['elena'],
    chainId: 'elena_children_dilemma',
    chainPosition: 4,
    choices: [
      {
        id: 'allow_interview',
        text: 'Let her tell your story',
        outcomes: [
          { type: 'flag-set', target: 'story_shared', value: true },
          { type: 'stat-change', target: 'stress', value: 15 },
          { type: 'stat-change', target: 'communityConnection', value: 15 },
        ],
        outcomeText: 'You tell her about crossing the desert. About being afraid. About building a life in the shadows. Sofia types every word. "I\'m proud of you, Mommy." You\'ve never been more proud of her.',
        isRecommended: true,
      },
      {
        id: 'too_risky',
        text: 'It\'s too risky to have it written down',
        outcomes: [
          { type: 'stat-change', target: 'stress', value: 20 },
          { type: 'relationship-change', target: 'sofia', value: -10 },
        ],
        outcomeText: '"I\'m sorry, mija. I can\'t risk it." Sofia\'s face crumples. "But it\'s for school..." You hate saying no. But you\'ve spent 13 years being invisible. You can\'t stop now.',
      },
    ],
    tags: ['children', 'identity', 'sharing'],
    isRepeatable: false,
    isMandatory: false,
    priority: 5,
  },
  {
    id: 'elena_chain_sofia_distance',
    title: 'The Distance',
    description: 'Sofia is 14 now. She knows you\'re hiding something, even if she doesn\'t know what. The distance between you grows.',
    sceneType: 'home',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['elena'],
    chainId: 'elena_children_dilemma',
    chainPosition: 3,
    choices: [
      {
        id: 'finally_tell',
        text: 'Finally tell her the truth',
        outcomes: [
          { type: 'flag-set', target: 'told_children_truth', value: true },
          { type: 'stat-change', target: 'stress', value: 30 },
          { type: 'relationship-change', target: 'sofia', value: 15 },
        ],
        outcomeText: '"I\'m undocumented, Sofia. I came here when I was 19 without papers. I\'ve been hiding it because I was afraid." She\'s angry first. Then sad. Then she hugs you. "Why didn\'t you tell me?"',
      },
      {
        id: 'maintain_distance',
        text: 'Maintain the wall—it\'s safer this way',
        outcomes: [
          { type: 'stat-change', target: 'stress', value: 15 },
          { type: 'relationship-change', target: 'sofia', value: -15 },
        ],
        outcomeText: 'The secrets stay secrets. Sofia stops asking. She\'ll find out someday—these things always come out. But maybe by then, there will be papers. Maybe by then, it won\'t matter.',
      },
    ],
    tags: ['children', 'secrets', 'distance'],
    isRepeatable: false,
    isMandatory: false,
    priority: 5,
  },

  // === CHAIN 3: THE WORKPLACE INCIDENT (4 events deep) ===
  {
    id: 'elena_chain_workplace_start',
    title: 'The New Manager',
    description: 'There\'s a new manager at the cleaning company. He\'s asking questions. Checking documents more carefully. Looking at everyone a little too long.',
    sceneType: 'work',
    interruptPriority: 'important',
    timing: { type: 'random', earliestMonth: 12, latestMonth: 60 },
    conditions: [
      { type: 'character', target: 'id', operator: '==', value: 'elena' },
      { type: 'flag', target: 'workplace_scrutiny_started', operator: 'not-exists', value: true },
    ],
    weight: 45,
    characterIds: ['elena'],
    chainId: 'elena_workplace_incident',
    chainPosition: 1,
    isChainStart: true,
    choices: [
      {
        id: 'lay_low',
        text: 'Keep your head down and work hard',
        outcomes: [
          { type: 'flag-set', target: 'workplace_scrutiny_started', value: true },
          { type: 'flag-set', target: 'laying_low', value: true },
          { type: 'stat-change', target: 'stress', value: 20 },
        ],
        outcomeText: 'You arrive early. Leave late. Don\'t take breaks with the others. Make yourself indispensable. Invisible. The manager\'s eyes pass over you.',
        nextEventId: 'elena_chain_workplace_audit',
      },
      {
        id: 'find_new_job',
        text: 'Start looking for a new job quietly',
        outcomes: [
          { type: 'flag-set', target: 'workplace_scrutiny_started', value: true },
          { type: 'flag-set', target: 'job_searching', value: true },
          { type: 'stat-change', target: 'stress', value: 15 },
        ],
        outcomeText: 'You ask around the community. Another cleaning company. A restaurant. Anywhere that pays cash and doesn\'t ask questions. But good jobs are hard to find.',
        nextEventId: 'elena_chain_new_job_search',
      },
    ],
    tags: ['work', 'fear', 'survival'],
    isRepeatable: false,
    isMandatory: false,
    priority: 7,
  },
  {
    id: 'elena_chain_workplace_audit',
    title: 'The Audit',
    description: '"ICE audit." The words spread through the workplace like fire. Everyone who might have problems is terrified. You don\'t come to work for three days.',
    sceneType: 'work',
    interruptPriority: 'critical',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['elena'],
    chainId: 'elena_workplace_incident',
    chainPosition: 2,
    choices: [
      {
        id: 'quit_immediately',
        text: 'Quit before they look too closely',
        outcomes: [
          { type: 'flag-set', target: 'quit_job', value: true },
          { type: 'stat-change', target: 'stress', value: 25 },
        ],
        outcomeText: 'You text your boss that you\'re not coming back. Family emergency. No questions asked. You lose the job but avoid the scrutiny. Now you need to find new work. Fast.',
        nextEventId: 'elena_chain_job_loss_aftermath',
      },
      {
        id: 'wait_it_out',
        text: 'Wait and see what happens',
        outcomes: [
          { type: 'flag-set', target: 'risked_audit', value: true },
          { type: 'stat-change', target: 'stress', value: 35 },
        ],
        outcomeText: 'You go back to work. Heart pounding. The audit happens. Names are checked. Your documents—the ones that might not hold up to scrutiny—are examined. You wait.',
        nextEventId: 'elena_chain_audit_result',
      },
    ],
    tags: ['work', 'ice', 'fear', 'critical'],
    isRepeatable: false,
    isMandatory: false,
    priority: 9,
  },
  {
    id: 'elena_chain_audit_result',
    title: 'The Aftermath',
    description: 'The audit is complete. Your boss calls you into the office.',
    sceneType: 'work',
    interruptPriority: 'critical',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['elena'],
    chainId: 'elena_workplace_incident',
    chainPosition: 3,
    choices: [
      {
        id: 'survived_audit',
        text: 'Hear what they have to say...',
        outcomes: [
          { type: 'flag-set', target: 'survived_audit', value: true },
          { type: 'stat-change', target: 'stress', value: -20 },
        ],
        outcomeText: '"Your paperwork checked out." You almost cry with relief. You don\'t know how. Maybe the documents were never examined closely. Maybe you got lucky. Either way, you still have a job.',
        probability: 0.6,
      },
      {
        id: 'caught_in_audit',
        text: 'Hear what they have to say...',
        outcomes: [
          { type: 'flag-set', target: 'caught_in_audit', value: true },
          { type: 'stat-change', target: 'stress', value: 45 },
        ],
        outcomeText: '"Elena, there\'s a problem with your I-9 documents. I\'m going to have to let you go." No ICE. No arrest. Just fired. But now there\'s a record somewhere that your documents didn\'t hold up.',
        nextEventId: 'elena_chain_job_loss_aftermath',
        probability: 0.4,
      },
    ],
    tags: ['work', 'audit', 'critical'],
    isRepeatable: false,
    isMandatory: false,
    priority: 10,
  },
  {
    id: 'elena_chain_job_loss_aftermath',
    title: 'Without Work',
    description: 'The bills don\'t stop. Michael\'s salary covers the mortgage, barely. But the utilities. The groceries. Sofia needs braces. Diego needs new shoes.',
    sceneType: 'home',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['elena'],
    chainId: 'elena_workplace_incident',
    chainPosition: 4,
    choices: [
      {
        id: 'find_cash_work',
        text: 'Find work that pays cash',
        outcomes: [
          { type: 'flag-set', target: 'cash_work', value: true },
          { type: 'stat-change', target: 'stress', value: 15 },
        ],
        outcomeText: 'House cleaning for private clients. Helping at a friend\'s food truck. Babysitting for neighbors. Piece work. No benefits. No protections. But it\'s income.',
      },
      {
        id: 'michael_extra_work',
        text: 'Michael takes extra shifts',
        outcomes: [
          { type: 'relationship-change', target: 'michael', value: -10 },
          { type: 'stat-change', target: 'stress', value: 20 },
        ],
        outcomeText: 'Michael works overtime. Weekends. He\'s exhausted. You hardly see him. "This isn\'t sustainable," he says one night. "I know," you reply. There are no good options.',
      },
    ],
    tags: ['work', 'money', 'survival'],
    isRepeatable: false,
    isMandatory: false,
    priority: 6,
  },
  {
    id: 'elena_chain_new_job_search',
    title: 'The Search',
    description: 'Through the community network, you hear about a job at a small restaurant. The owner doesn\'t ask too many questions. The pay is less, but it might be safer.',
    sceneType: 'community',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['elena'],
    chainId: 'elena_workplace_incident',
    chainPosition: 2,
    choices: [
      {
        id: 'take_restaurant_job',
        text: 'Take the restaurant job',
        outcomes: [
          { type: 'flag-set', target: 'new_job_found', value: true },
          { type: 'stat-change', target: 'stress', value: -10 },
        ],
        outcomeText: 'You start as a prep cook. The hours are long. The pay is $3 an hour less. But the owner is himself an immigrant. He understands. He protects his workers.',
        isRecommended: true,
      },
      {
        id: 'stay_at_current',
        text: 'Stay at your current job despite the risks',
        outcomes: [
          { type: 'stat-change', target: 'stress', value: 20 },
        ],
        outcomeText: 'Better the devil you know. You decide to stay, be more careful, keep your head down. The new manager\'s scrutiny eventually fades. Or maybe you just stopped noticing.',
      },
    ],
    tags: ['work', 'community', 'decision'],
    isRepeatable: false,
    isMandatory: false,
    priority: 6,
  },

  // === ADDITIONAL STANDALONE EVENTS ===
  {
    id: 'elena_driving_fear',
    title: 'The Red and Blue Lights',
    description: 'Police lights behind you on the highway. Your heart stops. You pull over, hands shaking on the wheel.',
    sceneType: 'street',
    interruptPriority: 'important',
    timing: { type: 'random', earliestMonth: 6, latestMonth: 72 },
    conditions: [
      { type: 'character', target: 'id', operator: '==', value: 'elena' },
    ],
    weight: 50,
    characterIds: ['elena'],
    choices: [
      {
        id: 'stay_calm',
        text: 'Stay calm. You weren\'t doing anything wrong.',
        outcomes: [
          { type: 'stat-change', target: 'stress', value: 30 },
        ],
        outcomeText: '"License and registration." Your state issues licenses regardless of status. You hand them over. "Broken tail light," he says. "Get it fixed." He leaves. You sit there for ten minutes before you can drive again.',
        probability: 0.9,
      },
      {
        id: 'panic',
        text: 'The panic takes over',
        outcomes: [
          { type: 'stat-change', target: 'stress', value: 40 },
          { type: 'stat-change', target: 'health', value: -5 },
        ],
        outcomeText: 'Your hands won\'t stop shaking. Your voice cracks. The officer looks at you strangely. "Are you okay, ma\'am?" "Yes. Sorry. Just nervous." He writes the ticket and leaves. You have a panic attack in the parked car.',
        probability: 0.1,
      },
    ],
    tags: ['daily-life', 'fear', 'police'],
    isRepeatable: true,
    isMandatory: false,
    priority: 5,
  },
  {
    id: 'elena_school_event',
    title: 'The School Event',
    description: 'Diego\'s class is having a multicultural day. He wants you to come and make tamales. "Please, Mommy? Everyone else\'s mom is coming."',
    sceneType: 'community',
    timing: { type: 'random', earliestMonth: 6, latestMonth: 48 },
    conditions: [
      { type: 'character', target: 'id', operator: '==', value: 'elena' },
    ],
    weight: 55,
    characterIds: ['elena'],
    choices: [
      {
        id: 'go_to_school',
        text: 'Go to the school event',
        outcomes: [
          { type: 'stat-change', target: 'stress', value: 15 },
          { type: 'stat-change', target: 'communityConnection', value: 10 },
          { type: 'relationship-change', target: 'diego', value: 10 },
        ],
        outcomeText: 'You make 40 tamales. Diego beams when you walk in. The other parents smile. For an hour, you\'re just a mom sharing her culture. It\'s worth the risk.',
        isRecommended: true,
      },
      {
        id: 'send_michael',
        text: 'Ask Michael to go instead',
        outcomes: [
          { type: 'stat-change', target: 'stress', value: 10 },
          { type: 'relationship-change', target: 'diego', value: -5 },
        ],
        outcomeText: 'Michael takes the tamales. Diego is happy but confused. "Why couldn\'t Mommy come?" "She had to work, buddy." Another small lie. Another small absence.',
      },
    ],
    tags: ['children', 'community', 'risk'],
    isRepeatable: true,
    isMandatory: false,
    priority: 4,
  },
  {
    id: 'elena_medical_emergency',
    title: 'The Emergency Room',
    description: 'Diego falls from the playground. His arm is bent wrong. You need to go to the emergency room. But hospitals ask for ID. For insurance. For documents.',
    sceneType: 'hospital',
    interruptPriority: 'critical',
    timing: { type: 'random', earliestMonth: 12, latestMonth: 72 },
    conditions: [
      { type: 'character', target: 'id', operator: '==', value: 'elena' },
    ],
    weight: 35,
    characterIds: ['elena'],
    choices: [
      {
        id: 'go_to_er',
        text: 'Take him to the ER immediately',
        outcomes: [
          { type: 'stat-change', target: 'stress', value: 25 },
          { type: 'finance-subtract', target: 'ER Bill', value: 2500 },
        ],
        outcomeText: 'Your child is hurt. Nothing else matters. At the ER, they treat first, ask questions later. Diego gets a cast. You get a bill you\'ll pay in installments for a year.',
        isRecommended: true,
      },
      {
        id: 'call_michael',
        text: 'Call Michael to take him',
        outcomes: [
          { type: 'stat-change', target: 'stress', value: 20 },
          { type: 'relationship-change', target: 'michael', value: -5 },
        ],
        outcomeText: 'Michael rushes home from work. Takes Diego to the hospital. Hours later: "He\'s fine. Broken arm but he\'s fine." You weep with relief and guilt. You should have been there.',
      },
    ],
    tags: ['medical', 'children', 'fear', 'critical'],
    isRepeatable: false,
    isMandatory: false,
    priority: 9,
  },
  {
    id: 'elena_family_in_mexico',
    title: 'The Video Call',
    description: 'Your mother\'s face on the phone screen, older every year. "When will you come home, mija? Even just to visit?" You can\'t explain that visiting means never coming back.',
    sceneType: 'home',
    timing: { type: 'random', earliestMonth: 12, latestMonth: 72 },
    conditions: [
      { type: 'character', target: 'id', operator: '==', value: 'elena' },
    ],
    weight: 45,
    characterIds: ['elena'],
    choices: [
      {
        id: 'honest_with_mother',
        text: 'Tell her the truth about why you can\'t visit',
        outcomes: [
          { type: 'stat-change', target: 'stress', value: 20 },
        ],
        outcomeText: '"Mamá, if I leave, I can\'t come back. Maybe not ever." She\'s silent for a long time. "I understand, mija. I just miss you." "I miss you too, Mamá. Every day."',
        isRecommended: true,
      },
      {
        id: 'make_promises',
        text: 'Promise you\'ll visit someday',
        outcomes: [
          { type: 'stat-change', target: 'stress', value: 15 },
        ],
        outcomeText: '"Soon, Mamá. I\'ll come soon." You both know it might not be true. But the lie is kinder than the truth. She smiles. You smile. The screen freezes on her hopeful face.',
      },
    ],
    tags: ['family', 'mexico', 'emotional', 'sacrifice'],
    isRepeatable: true,
    isMandatory: false,
    priority: 4,
  },
]

// Event chains for tracking
export const ELENA_CHAINS: EventChain[] = [
  {
    id: 'elena_waiver_path',
    name: 'The Waiver Path',
    description: 'Elena pursues the I-601A waiver to legalize her status',
    eventIds: [
      'elena_chain_waiver_start',
      'elena_chain_waiver_explained',
      'elena_chain_building_case',
      'elena_chain_waiver_submission',
      'elena_chain_waiver_wait',
      'elena_chain_waiver_decision',
      'elena_chain_consular_trip',
      'elena_chain_consular_interview',
    ],
    currentPosition: 0,
    isInterruptible: false,
    characterIds: ['elena'],
  },
  {
    id: 'elena_children_dilemma',
    name: 'The Children\'s Dilemma',
    description: 'Elena navigates telling her American-born children about her status',
    eventIds: [
      'elena_chain_children_question_start',
      'elena_chain_children_growing',
      'elena_chain_children_know',
      'elena_chain_sofia_understands',
      'elena_chain_sofia_distance',
    ],
    currentPosition: 0,
    isInterruptible: true,
    characterIds: ['elena'],
  },
  {
    id: 'elena_workplace_incident',
    name: 'Workplace Incident',
    description: 'Elena faces workplace scrutiny and potential exposure',
    eventIds: [
      'elena_chain_workplace_start',
      'elena_chain_workplace_audit',
      'elena_chain_audit_result',
      'elena_chain_job_loss_aftermath',
      'elena_chain_new_job_search',
    ],
    currentPosition: 0,
    isInterruptible: true,
    characterIds: ['elena'],
  },
]
