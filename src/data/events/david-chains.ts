import type { GameEvent, EventChain } from '@/types'

// ============ DAVID H-1B DEEP DECISION CHAINS ============
// V2: Deep branching narratives with 4-8 event depth

export const DAVID_CHAIN_EVENTS: GameEvent[] = [
  // === CHAIN 1: THE LAYOFF CRISIS (7 events deep) ===
  {
    id: 'david_chain_layoff_start',
    title: 'The All-Hands Meeting',
    description: 'An emergency all-hands is called for 4 PM. The Slack channels go silent. Everyone knows what unscheduled all-hands means in tech.',
    sceneType: 'work',
    interruptPriority: 'critical',
    timing: { type: 'random', earliestMonth: 12, latestMonth: 60 },
    conditions: [
      { type: 'character', target: 'id', operator: '==', value: 'david' },
      { type: 'flag', target: 'layoff_crisis_started', operator: 'not-exists', value: true },
    ],
    weight: 40,
    characterIds: ['david'],
    chainId: 'david_layoff_crisis',
    chainPosition: 1,
    isChainStart: true,
    choices: [
      {
        id: 'attend_meeting',
        text: 'Join the all-hands call',
        outcomes: [
          { type: 'flag-set', target: 'layoff_crisis_started', value: true },
          { type: 'stat-change', target: 'stress', value: 30 },
        ],
        outcomeText: 'The CEO\'s face fills the screen. "This is the hardest announcement I\'ve ever had to make. We\'re reducing our workforce by 15%." Your heart stops. 15% could include you. And if you lose this job...',
        nextEventId: 'david_chain_layoff_wait',
      },
    ],
    tags: ['career', 'crisis', 'h1b', 'critical'],
    isRepeatable: false,
    isMandatory: false,
    priority: 10,
  },
  {
    id: 'david_chain_layoff_wait',
    title: 'The Wait',
    description: '"Affected employees will be notified by the end of the week." Five days. Five days of not knowing if your life in America ends.',
    sceneType: 'work',
    interruptPriority: 'important',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['david'],
    chainId: 'david_layoff_crisis',
    chainPosition: 2,
    choices: [
      {
        id: 'work_harder',
        text: 'Work even harder to prove your value',
        outcomes: [
          { type: 'stat-change', target: 'stress', value: 20 },
          { type: 'stat-change', target: 'health', value: -5 },
          { type: 'flag-set', target: 'overworked_during_layoffs', value: true },
        ],
        outcomeText: 'You stay until midnight every night. Ship features faster. Fix bugs. Make yourself indispensable. Your manager nods approvingly. But you know layoff lists were written before this week.',
        nextEventId: 'david_chain_layoff_result',
      },
      {
        id: 'prepare_backup',
        text: 'Start reaching out to other companies',
        outcomes: [
          { type: 'stat-change', target: 'stress', value: 15 },
          { type: 'flag-set', target: 'job_search_started', value: true },
        ],
        outcomeText: 'You update your LinkedIn. Quietly message recruiters. Every H-1B holder in tech is doing the same thing right now. The job market is about to be flooded with desperate, talented people.',
        nextEventId: 'david_chain_layoff_result',
        isRecommended: true,
      },
    ],
    tags: ['career', 'stress', 'waiting'],
    isRepeatable: false,
    isMandatory: false,
    priority: 8,
  },
  {
    id: 'david_chain_layoff_result',
    title: 'The Email',
    description: 'Friday morning. You refresh your inbox compulsively. Then it appears: an email from HR.',
    sceneType: 'work',
    interruptPriority: 'critical',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['david'],
    chainId: 'david_layoff_crisis',
    chainPosition: 3,
    choices: [
      {
        id: 'survived',
        text: 'Open the email...',
        outcomes: [
          { type: 'flag-set', target: 'survived_layoffs', value: true },
          { type: 'stat-change', target: 'stress', value: -20 },
        ],
        outcomeText: '"We are pleased to confirm that your position has not been affected." Relief floods through you. Then guilt. Your friend Raj in the next pod is packing his desk. He has 60 days to find a new sponsor or leave.',
        nextEventId: 'david_chain_survivor_guilt',
        probability: 0.7,
      },
      {
        id: 'laid_off',
        text: 'Open the email...',
        outcomes: [
          { type: 'flag-set', target: 'was_laid_off', value: true },
          { type: 'stat-change', target: 'stress', value: 50 },
        ],
        outcomeText: '"We regret to inform you that your position has been eliminated." The words blur. 60 days of work authorization remain. 60 days to find a new sponsor or pack up 8 years of life in America.',
        nextEventId: 'david_chain_60_day_clock',
        probability: 0.3,
      },
    ],
    tags: ['career', 'decision', 'critical'],
    isRepeatable: false,
    isMandatory: false,
    priority: 10,
  },
  {
    id: 'david_chain_survivor_guilt',
    title: 'Survivor\'s Guilt',
    description: 'Raj is gone. Deepa is gone. The office feels empty. You\'re still here, but the golden handcuffs feel tighter than ever.',
    sceneType: 'work',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['david'],
    chainId: 'david_layoff_crisis',
    chainPosition: 4,
    choices: [
      {
        id: 'help_friends',
        text: 'Help laid-off colleagues with job referrals',
        outcomes: [
          { type: 'stat-change', target: 'stress', value: 10 },
          { type: 'stat-change', target: 'communityConnection', value: 15 },
          { type: 'flag-set', target: 'helped_laid_off_friends', value: true },
        ],
        outcomeText: 'You spend evenings reviewing resumes, making introductions, writing referrals. Raj lands something in 45 days. Deepa... Deepa goes back to India. You couldn\'t save everyone.',
        isRecommended: true,
      },
      {
        id: 'keep_head_down',
        text: 'Keep your head down and focus on survival',
        outcomes: [
          { type: 'stat-change', target: 'stress', value: 20 },
          { type: 'stat-change', target: 'communityConnection', value: -10 },
        ],
        outcomeText: 'You can\'t help everyone. You have to protect Priya and yourself. The next round of layoffs could hit anyone. You become quieter, more cautious, less visible.',
      },
    ],
    tags: ['career', 'moral', 'community'],
    isRepeatable: false,
    isMandatory: false,
    priority: 6,
  },
  {
    id: 'david_chain_60_day_clock',
    title: 'The 60-Day Clock',
    description: 'Day 1 of 60. Your H-1B grace period starts now. Priya\'s H-4 depends on you. Your apartment lease. Your life.',
    sceneType: 'home',
    interruptPriority: 'critical',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['david'],
    chainId: 'david_layoff_crisis',
    chainPosition: 4,
    choices: [
      {
        id: 'aggressive_search',
        text: 'Full-time job search starting now',
        outcomes: [
          { type: 'flag-set', target: 'aggressive_job_search', value: true },
          { type: 'stat-change', target: 'stress', value: 30 },
        ],
        outcomeText: '10 applications a day. Every recruiter you know. Every connection on LinkedIn. You treat finding a job like the emergency it is. Priya watches you work 14-hour days on job hunting.',
        nextEventId: 'david_chain_job_search_progress',
      },
      {
        id: 'consider_india',
        text: 'Research going back to India as backup',
        outcomes: [
          { type: 'flag-set', target: 'considering_return', value: true },
          { type: 'stat-change', target: 'stress', value: 20 },
          { type: 'relationship-change', target: 'priya', value: -10 },
        ],
        outcomeText: 'You look at jobs in Bangalore. The salaries are 1/5 of what you make here. Your parents would be happy. Priya wouldn\'t. "We built our life here," she says. "Don\'t give up yet."',
        nextEventId: 'david_chain_job_search_progress',
      },
    ],
    tags: ['career', 'crisis', 'h1b', 'time-pressure'],
    isRepeatable: false,
    isMandatory: false,
    priority: 10,
  },
  {
    id: 'david_chain_job_search_progress',
    title: 'Day 30',
    description: 'Halfway through your grace period. Three final-round interviews. Two ghosted. One... one might come through.',
    sceneType: 'home',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['david'],
    chainId: 'david_layoff_crisis',
    chainPosition: 5,
    choices: [
      {
        id: 'push_for_decision',
        text: 'Call the company and explain your timeline',
        outcomes: [
          { type: 'flag-set', target: 'disclosed_timeline', value: true },
          { type: 'stat-change', target: 'stress', value: 20 },
        ],
        outcomeText: '"I need to let you know—I\'m on an H-1B grace period. I need an answer within 30 days or I have to leave the country." The recruiter pauses. "I\'ll talk to the hiring manager."',
        nextEventId: 'david_chain_job_offer_decision',
      },
      {
        id: 'keep_waiting',
        text: 'Keep interviewing, don\'t reveal desperation',
        outcomes: [
          { type: 'flag-set', target: 'hid_timeline', value: true },
          { type: 'stat-change', target: 'stress', value: 25 },
        ],
        outcomeText: 'You interview with three more companies. Hide your desperation. Project confidence. The clock ticks. Day 35. Day 40. Day 45...',
        nextEventId: 'david_chain_job_offer_decision',
      },
    ],
    tags: ['career', 'job-search', 'time-pressure'],
    isRepeatable: false,
    isMandatory: false,
    priority: 8,
  },
  {
    id: 'david_chain_job_offer_decision',
    title: 'Day 52',
    description: 'Eight days left. Your phone rings with an unknown number.',
    sceneType: 'home',
    interruptPriority: 'critical',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['david'],
    chainId: 'david_layoff_crisis',
    chainPosition: 6,
    variants: [
      {
        condition: { type: 'flag', target: 'disclosed_timeline', operator: '==', value: true },
        descriptionOverride: 'Eight days left. The company you called wants to extend an offer—if you can start Monday.',
      },
    ],
    choices: [
      {
        id: 'accept_offer',
        text: 'Accept the offer',
        requirements: [{ type: 'flag', target: 'disclosed_timeline', operator: '==', value: true }],
        outcomes: [
          { type: 'flag-set', target: 'found_new_sponsor', value: true },
          { type: 'stat-change', target: 'stress', value: -40 },
        ],
        outcomeText: '"We\'re prepared to sponsor your H-1B transfer. The salary is... lower than your previous role, but we can start the paperwork immediately." You don\'t negotiate. You can\'t afford to.',
        nextEventId: 'david_chain_new_job_start',
      },
      {
        id: 'last_minute_save',
        text: 'Answer the call...',
        requirements: [{ type: 'flag', target: 'hid_timeline', operator: '==', value: true }],
        outcomes: [
          { type: 'flag-set', target: 'last_minute_offer', value: true },
          { type: 'stat-change', target: 'stress', value: -30 },
        ],
        outcomeText: '"David? This is Sarah from TechCorp. We\'d like to make you an offer. Can you start in two weeks?" Your hands shake. "Yes. Absolutely yes."',
        nextEventId: 'david_chain_new_job_start',
        probability: 0.6,
      },
      {
        id: 'no_offer_comes',
        text: 'Answer the call...',
        requirements: [{ type: 'flag', target: 'hid_timeline', operator: '==', value: true }],
        outcomes: [
          { type: 'flag-set', target: 'no_offer_received', value: true },
          { type: 'stat-change', target: 'stress', value: 40 },
        ],
        outcomeText: 'It\'s a spam call about car insurance. Day 52 passes. Day 55. Day 58. You start packing boxes. Priya books flights to Delhi. Eight years, and this is how it ends.',
        nextEventId: 'david_chain_leaving_america',
        probability: 0.4,
      },
    ],
    tags: ['career', 'offer', 'critical', 'climax'],
    isRepeatable: false,
    isMandatory: false,
    priority: 10,
  },
  {
    id: 'david_chain_new_job_start',
    title: 'Starting Over',
    description: 'New badge. New desk. New company. The salary is $40,000 less than before. Your green card application has to restart from scratch.',
    sceneType: 'work',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['david'],
    chainId: 'david_layoff_crisis',
    chainPosition: 7,
    choices: [
      {
        id: 'grateful',
        text: 'Be grateful you\'re still here',
        outcomes: [
          { type: 'stat-change', target: 'stress', value: -10 },
          { type: 'finance-subtract', target: 'Salary Reduction (annual)', value: 40000 },
          { type: 'flag-set', target: 'green_card_reset', value: true },
        ],
        outcomeText: 'You\'re alive. You\'re employed. You\'re legal. Five years of green card waiting—gone. The EB-2 backlog doesn\'t care about your seniority. You start over. At least you get to start over.',
      },
    ],
    tags: ['career', 'restart', 'bittersweet'],
    isRepeatable: false,
    isMandatory: false,
    priority: 7,
  },
  {
    id: 'david_chain_leaving_america',
    title: 'Departure',
    description: 'The apartment is empty. Boxes have been shipped or sold. Eight years packed into a suitcase.',
    sceneType: 'airport',
    interruptPriority: 'critical',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['david'],
    chainId: 'david_layoff_crisis',
    chainPosition: 7,
    choices: [
      {
        id: 'leave_with_priya',
        text: 'Board the flight home',
        outcomes: [
          { type: 'flag-set', target: 'returned_to_india', value: true },
          { type: 'stat-change', target: 'stress', value: 30 },
          { type: 'stat-change', target: 'communityConnection', value: -40 },
          { type: 'end-game', target: 'returned-home', value: true },
        ],
        outcomeText: 'At the gate, you look back one last time. America. Your students, your friends, your dreams. All left behind. Priya takes your hand. "We\'ll be okay." You board the plane.',
      },
    ],
    tags: ['ending', 'departure', 'emotional'],
    isRepeatable: false,
    isMandatory: false,
    priority: 10,
  },

  // === CHAIN 2: THE GREEN CARD BACKLOG (6 events deep) ===
  {
    id: 'david_chain_backlog_start',
    title: 'The Priority Date',
    description: 'Your PERM labor certification is approved. Now you check the Visa Bulletin obsessively. Your priority date: 2019. Current processing: 2012.',
    sceneType: 'home',
    timing: { type: 'random', earliestMonth: 6, latestMonth: 36 },
    conditions: [
      { type: 'character', target: 'id', operator: '==', value: 'david' },
      { type: 'flag', target: 'perm_approved', operator: 'not-exists', value: true },
    ],
    weight: 60,
    characterIds: ['david'],
    chainId: 'david_green_card_wait',
    chainPosition: 1,
    isChainStart: true,
    choices: [
      {
        id: 'do_the_math',
        text: 'Calculate how long this will take',
        outcomes: [
          { type: 'flag-set', target: 'perm_approved', value: true },
          { type: 'flag-set', target: 'calculated_wait', value: true },
          { type: 'stat-change', target: 'stress', value: 25 },
        ],
        outcomeText: 'Seven years behind. The backlog moves about 2-3 weeks per month. That means... you do the math three times because the answer can\'t be right. 40+ years. You\'ll be 70 before your green card.',
        nextEventId: 'david_chain_backlog_reality',
      },
      {
        id: 'ignore_for_now',
        text: 'Don\'t think about it too much',
        outcomes: [
          { type: 'flag-set', target: 'perm_approved', value: true },
          { type: 'flag-set', target: 'backlog_denial', value: true },
          { type: 'stat-change', target: 'stress', value: 10 },
        ],
        outcomeText: 'You close the spreadsheet. Stop checking the bulletin. Focus on work, on Priya, on life. The backlog exists in some abstract future. Denial is a survival mechanism.',
        nextEventId: 'david_chain_backlog_reality',
      },
    ],
    tags: ['immigration', 'green-card', 'backlog', 'frustration'],
    isRepeatable: false,
    isMandatory: false,
    priority: 7,
  },
  {
    id: 'david_chain_backlog_reality',
    title: 'The Visa Bulletin',
    description: 'Another month. The Visa Bulletin releases. The EB-2 India line has moved... one week. One week for a month of waiting.',
    sceneType: 'home',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['david'],
    chainId: 'david_green_card_wait',
    chainPosition: 2,
    choices: [
      {
        id: 'research_alternatives',
        text: 'Research alternative paths',
        outcomes: [
          { type: 'flag-set', target: 'researched_alternatives', value: true },
          { type: 'stat-change', target: 'stress', value: 15 },
        ],
        outcomeText: 'EB-1 for "extraordinary ability"? Need to prove you\'re in the top of your field. Start a company for EB-5? Need $800,000 minimum. Move to Canada? They have a points system...',
        nextEventId: 'david_chain_alternatives_decision',
      },
      {
        id: 'accept_wait',
        text: 'Accept the wait and live your life',
        outcomes: [
          { type: 'flag-set', target: 'accepted_backlog', value: true },
          { type: 'stat-change', target: 'stress', value: 5 },
        ],
        outcomeText: 'You stop checking the bulletin every month. Focus on what you can control. Build your career. Save money. Love Priya. The green card will come when it comes. Or it won\'t.',
        nextEventId: 'david_chain_years_pass',
        isRecommended: true,
      },
    ],
    tags: ['immigration', 'waiting', 'frustration'],
    isRepeatable: false,
    isMandatory: false,
    priority: 5,
  },
  {
    id: 'david_chain_alternatives_decision',
    title: 'The Alternatives',
    description: 'You and Priya sit at the kitchen table with printouts of different immigration paths. Canada, EB-1, staying the course.',
    sceneType: 'home',
    interruptPriority: 'important',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['david'],
    chainId: 'david_green_card_wait',
    chainPosition: 3,
    choices: [
      {
        id: 'try_eb1',
        text: 'Pursue EB-1 "extraordinary ability"',
        costs: [{ type: 'money', amount: 5000, description: 'Lawyer fees for EB-1 evaluation' }],
        outcomes: [
          { type: 'finance-subtract', target: 'EB-1 Evaluation', value: 5000 },
          { type: 'flag-set', target: 'pursuing_eb1', value: true },
          { type: 'stat-change', target: 'stress', value: 20 },
        ],
        outcomeText: 'The lawyer reviews your profile. "You have patents. Publications. Awards. We can try, but EB-1 is subjective. No guarantees." You pay the retainer and start building your case.',
        nextEventId: 'david_chain_eb1_outcome',
      },
      {
        id: 'canada_research',
        text: 'Apply for Canadian Express Entry',
        costs: [{ type: 'money', amount: 2000, description: 'Canadian immigration fees' }],
        outcomes: [
          { type: 'finance-subtract', target: 'Canada Application', value: 2000 },
          { type: 'flag-set', target: 'applied_to_canada', value: true },
          { type: 'stat-change', target: 'stress', value: 15 },
        ],
        outcomeText: 'Points: Education (25), Age (17), Language (28), Work Experience (15). Total: 85. The cutoff fluctuates around 470. You\'re competitive. You could have a PR in 6 months.',
        nextEventId: 'david_chain_canada_decision',
      },
      {
        id: 'stay_course',
        text: 'Stay the course in the US',
        outcomes: [
          { type: 'flag-set', target: 'staying_course', value: true },
          { type: 'stat-change', target: 'stress', value: 10 },
        ],
        outcomeText: '"This is our home," Priya says. "Let\'s not uproot everything for what-ifs." You nod. The backlog is painful, but at least you\'re here. Building a life, even in uncertainty.',
        nextEventId: 'david_chain_years_pass',
      },
    ],
    tags: ['immigration', 'decision', 'alternatives'],
    isRepeatable: false,
    isMandatory: false,
    priority: 7,
  },
  {
    id: 'david_chain_eb1_outcome',
    title: 'The EB-1 Decision',
    description: 'Six months of gathering evidence. Patents, citations, recommendation letters from industry leaders. The lawyer submits the petition.',
    sceneType: 'uscis',
    interruptPriority: 'critical',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['david'],
    chainId: 'david_green_card_wait',
    chainPosition: 4,
    choices: [
      {
        id: 'eb1_approved',
        text: 'Check the status...',
        outcomes: [
          { type: 'flag-set', target: 'eb1_approved', value: true },
          { type: 'stat-change', target: 'stress', value: -40 },
          { type: 'status-change', target: 'i485-pending', value: true },
        ],
        outcomeText: '"Approved." The word feels unreal. No more 40-year wait. No more being tied to one employer. The I-485 can be filed immediately. In a year, maybe less, you\'ll have a green card.',
        probability: 0.3,
      },
      {
        id: 'eb1_denied',
        text: 'Check the status...',
        outcomes: [
          { type: 'flag-set', target: 'eb1_denied', value: true },
          { type: 'stat-change', target: 'stress', value: 30 },
        ],
        outcomeText: '"The petitioner has not demonstrated extraordinary ability." $5,000 and six months of hope, denied. The EB-2 backlog waits. The 40-year calculation hasn\'t changed.',
        probability: 0.7,
        nextEventId: 'david_chain_years_pass',
      },
    ],
    tags: ['immigration', 'eb1', 'decision', 'critical'],
    isRepeatable: false,
    isMandatory: false,
    priority: 9,
  },
  {
    id: 'david_chain_canada_decision',
    title: 'The Canada Offer',
    description: 'Three months later. An email from Immigration, Refugees and Citizenship Canada. Your Express Entry application has been selected.',
    sceneType: 'home',
    interruptPriority: 'critical',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['david'],
    chainId: 'david_green_card_wait',
    chainPosition: 4,
    choices: [
      {
        id: 'accept_canada',
        text: 'Accept and move to Canada',
        outcomes: [
          { type: 'flag-set', target: 'moving_to_canada', value: true },
          { type: 'stat-change', target: 'stress', value: 20 },
          { type: 'stat-change', target: 'communityConnection', value: -20 },
        ],
        outcomeText: 'You accept. Begin the process of leaving everything you\'ve built. Friends. Career. Community. But in Canada, you\'ll be a permanent resident within a year. No employer chains. No decade-long waits.',
        nextEventId: 'david_chain_canada_life',
      },
      {
        id: 'decline_canada',
        text: 'Decline—you\'re staying in America',
        outcomes: [
          { type: 'flag-set', target: 'declined_canada', value: true },
          { type: 'stat-change', target: 'stress', value: 10 },
        ],
        outcomeText: '"I can\'t leave," you tell Priya. "This is home. My friends, my career—everything I\'ve built is here." She squeezes your hand. "Then we wait. However long it takes."',
        nextEventId: 'david_chain_years_pass',
      },
    ],
    tags: ['immigration', 'canada', 'life-change', 'decision'],
    isRepeatable: false,
    isMandatory: false,
    priority: 9,
  },
  {
    id: 'david_chain_years_pass',
    title: 'Years Pass',
    description: 'Five years later. You\'re a senior engineer now. The visa bulletin has moved three years. Only 32 more years of waiting.',
    sceneType: 'neutral',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['david'],
    chainId: 'david_green_card_wait',
    chainPosition: 5,
    choices: [
      {
        id: 'keep_building',
        text: 'Keep building your life in uncertainty',
        outcomes: [
          { type: 'flag-set', target: 'accepted_uncertainty', value: true },
          { type: 'stat-change', target: 'stress', value: 5 },
        ],
        outcomeText: 'You buy furniture. Make friends. Get promoted. Live as if you\'ll be here forever, knowing you could be gone in 60 days if your job disappears. This is the immigrant condition.',
      },
      {
        id: 'consider_future',
        text: 'Wonder if there\'s a better way',
        outcomes: [
          { type: 'stat-change', target: 'stress', value: 15 },
        ],
        outcomeText: 'Your cousin in Canada has citizenship now. Your friend who moved to the UK has settled status. You\'re still waiting for a green card in the "land of immigrants." The irony isn\'t lost on you.',
      },
    ],
    tags: ['life', 'reflection', 'waiting'],
    isRepeatable: false,
    isMandatory: false,
    priority: 5,
  },
  {
    id: 'david_chain_canada_life',
    title: 'A New Country',
    description: 'Toronto. Cold. Different. Your Canadian permanent resident card arrives within a year. No more visa anxiety. But also—no more home.',
    sceneType: 'home',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['david'],
    chainId: 'david_green_card_wait',
    chainPosition: 5,
    choices: [
      {
        id: 'build_new_life',
        text: 'Build a new life in Canada',
        outcomes: [
          { type: 'flag-set', target: 'settled_in_canada', value: true },
          { type: 'stat-change', target: 'stress', value: -20 },
          { type: 'stat-change', target: 'communityConnection', value: 10 },
        ],
        outcomeText: 'The first year is hard. The second year gets easier. By the third, Toronto feels like home. You hold your PR card and feel something America never gave you: security.',
      },
    ],
    tags: ['canada', 'new-life', 'resolution'],
    isRepeatable: false,
    isMandatory: false,
    priority: 6,
  },

  // === CHAIN 3: PRIYA'S STRUGGLE (5 events deep) ===
  {
    id: 'david_chain_priya_dream_start',
    title: 'Priya\'s Dream',
    description: 'Priya shows you a job posting. Product manager at a startup. "I could do this," she says. Her eyes are bright with possibility—then dim. "But I can\'t. Can I?"',
    sceneType: 'home',
    timing: { type: 'random', earliestMonth: 12, latestMonth: 48 },
    conditions: [
      { type: 'character', target: 'id', operator: '==', value: 'david' },
      { type: 'flag', target: 'priya_work_issue_started', operator: 'not-exists', value: true },
    ],
    weight: 50,
    characterIds: ['david'],
    chainId: 'david_priya_struggle',
    chainPosition: 1,
    isChainStart: true,
    choices: [
      {
        id: 'research_h4_ead',
        text: 'Research the H-4 EAD option',
        outcomes: [
          { type: 'flag-set', target: 'priya_work_issue_started', value: true },
          { type: 'flag-set', target: 'researching_h4_ead', value: true },
          { type: 'stat-change', target: 'stress', value: 15 },
        ],
        outcomeText: 'H-4 EAD: Work authorization for H-4 spouses. But only if your I-140 is approved. And the program itself is under threat—lawsuits, executive orders, uncertainty.',
        nextEventId: 'david_chain_h4_ead_research',
      },
      {
        id: 'discourage_gently',
        text: 'Gently explain the limitations',
        outcomes: [
          { type: 'flag-set', target: 'priya_work_issue_started', value: true },
          { type: 'relationship-change', target: 'priya', value: -15 },
          { type: 'stat-change', target: 'stress', value: 10 },
        ],
        outcomeText: '"Your status is tied to mine," you say. "Working without authorization could jeopardize everything." Priya nods, but something dims in her eyes. Another dream deferred.',
        nextEventId: 'david_chain_priya_frustration',
      },
    ],
    tags: ['relationship', 'h4', 'career', 'frustration'],
    isRepeatable: false,
    isMandatory: false,
    priority: 6,
  },
  {
    id: 'david_chain_h4_ead_research',
    title: 'The H-4 EAD Path',
    description: 'Your I-140 is approved—Priya could apply for work authorization. But the program has been challenged in court. Its future is uncertain.',
    sceneType: 'home',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['david'],
    chainId: 'david_priya_struggle',
    chainPosition: 2,
    choices: [
      {
        id: 'apply_h4_ead',
        text: 'Apply for H-4 EAD',
        costs: [{ type: 'money', amount: 410, description: 'H-4 EAD filing fee' }],
        outcomes: [
          { type: 'finance-subtract', target: 'H-4 EAD Fee', value: 410 },
          { type: 'flag-set', target: 'h4_ead_applied', value: true },
          { type: 'stat-change', target: 'stress', value: 10 },
        ],
        outcomeText: 'You file the application together. $410 and a stack of forms for the privilege of letting Priya work. She deserves better than this system gives her.',
        nextEventId: 'david_chain_priya_working',
      },
      {
        id: 'wait_for_stability',
        text: 'Wait until the program is more stable',
        outcomes: [
          { type: 'flag-set', target: 'h4_ead_delayed', value: true },
          { type: 'relationship-change', target: 'priya', value: -10 },
          { type: 'stat-change', target: 'stress', value: 15 },
        ],
        outcomeText: '"What if they revoke it after I\'ve started working?" Priya asks. "Then what?" You don\'t have an answer. The uncertainty extends to everything.',
        nextEventId: 'david_chain_priya_frustration',
      },
    ],
    tags: ['immigration', 'h4', 'ead', 'decision'],
    isRepeatable: false,
    isMandatory: false,
    priority: 6,
  },
  {
    id: 'david_chain_priya_working',
    title: 'Priya\'s First Day',
    description: 'Her H-4 EAD arrives after six months of waiting. Priya lands a job at a tech startup. Her first day of work in eight years.',
    sceneType: 'home',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['david'],
    chainId: 'david_priya_struggle',
    chainPosition: 3,
    choices: [
      {
        id: 'celebrate_together',
        text: 'Celebrate this milestone',
        outcomes: [
          { type: 'flag-set', target: 'priya_working', value: true },
          { type: 'relationship-change', target: 'priya', value: 20 },
          { type: 'stat-change', target: 'stress', value: -15 },
        ],
        outcomeText: 'You take her to the restaurant where you had your first date. "To new beginnings," she toasts. Her smile is brighter than it\'s been in years. This is who she was meant to be.',
        isRecommended: true,
      },
    ],
    tags: ['relationship', 'celebration', 'career'],
    isRepeatable: false,
    isMandatory: false,
    priority: 6,
  },
  {
    id: 'david_chain_priya_frustration',
    title: 'The Breaking Point',
    description: 'Priya\'s MBA classmates are VPs now. Directors. She has the same degree, the same ability. "I\'m just a visa," she says. "That\'s all I am here."',
    sceneType: 'home',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['david'],
    chainId: 'david_priya_struggle',
    chainPosition: 3,
    choices: [
      {
        id: 'emotional_support',
        text: 'Listen and support her',
        outcomes: [
          { type: 'relationship-change', target: 'priya', value: 5 },
          { type: 'stat-change', target: 'stress', value: 10 },
        ],
        outcomeText: 'You hold her while she cries. There\'s nothing you can say to fix this. The system wasn\'t built for talented people like her. It was built to keep them out.',
      },
      {
        id: 'problem_solve',
        text: 'Try to brainstorm solutions',
        outcomes: [
          { type: 'relationship-change', target: 'priya', value: -5 },
          { type: 'stat-change', target: 'stress', value: 15 },
        ],
        outcomeText: '"What about remote work for an Indian company? Or freelance consulting?" Priya\'s face hardens. "I don\'t want workarounds. I want my career back."',
      },
    ],
    tags: ['relationship', 'frustration', 'emotional'],
    isRepeatable: false,
    isMandatory: false,
    priority: 5,
  },

  // === ADDITIONAL STANDALONE EVENTS FOR DAVID ===
  {
    id: 'david_visa_stamp',
    title: 'Visa Stamp Trip',
    description: 'Your visa stamp in your passport has expired. To travel internationally and return, you need a new one. That means a consular appointment.',
    sceneType: 'uscis',
    interruptPriority: 'important',
    timing: { type: 'random', earliestMonth: 24, latestMonth: 72 },
    conditions: [
      { type: 'character', target: 'id', operator: '==', value: 'david' },
    ],
    weight: 45,
    characterIds: ['david'],
    choices: [
      {
        id: 'india_trip',
        text: 'Schedule an appointment in India',
        costs: [{ type: 'money', amount: 2500, description: 'Trip to India + visa fees' }],
        outcomes: [
          { type: 'finance-subtract', target: 'Visa Stamp Trip', value: 2500 },
          { type: 'flag-set', target: 'visa_stamping_scheduled', value: true },
          { type: 'stat-change', target: 'stress', value: 25 },
        ],
        outcomeText: 'Chennai consulate, three months out. You book flights, wondering: What if they deny the stamp? What if 221(g) processing takes months? You could be stuck.',
        nextEventId: 'david_visa_stamp_outcome',
      },
      {
        id: 'avoid_travel',
        text: 'Avoid international travel until green card',
        outcomes: [
          { type: 'flag-set', target: 'avoiding_travel', value: true },
          { type: 'stat-change', target: 'stress', value: 10 },
        ],
        outcomeText: 'Your parents haven\'t seen you in three years. Weddings, funerals, festivals—you miss them all. But at least you\'re not stuck outside America waiting for a stamp.',
      },
    ],
    tags: ['travel', 'visa', 'risk', 'family'],
    isRepeatable: false,
    isMandatory: false,
    priority: 6,
  },
  {
    id: 'david_visa_stamp_outcome',
    title: 'The Consular Interview',
    description: 'Chennai. The US Consulate. A sea of anxious faces. Your number is called.',
    sceneType: 'uscis',
    interruptPriority: 'critical',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['david'],
    choices: [
      {
        id: 'approved_stamp',
        text: 'The interview...',
        outcomes: [
          { type: 'flag-set', target: 'visa_stamped', value: true },
          { type: 'stat-change', target: 'stress', value: -25 },
        ],
        outcomeText: '"What do you do?" "Software engineer." "Same company as before?" "Yes." The officer stamps your passport. Three minutes. Three minutes of terror for a stamp that lets you go home.',
        probability: 0.85,
      },
      {
        id: 'admin_processing',
        text: 'The interview...',
        outcomes: [
          { type: 'flag-set', target: 'visa_221g', value: true },
          { type: 'stat-change', target: 'stress', value: 40 },
        ],
        outcomeText: '"Your case requires additional administrative processing." 221(g). The dreaded blue slip. No timeline. No explanation. You\'re stuck in India, unable to return to your job, your home, your life.',
        probability: 0.15,
      },
    ],
    tags: ['visa', 'interview', 'critical'],
    isRepeatable: false,
    isMandatory: false,
    priority: 10,
  },
  {
    id: 'david_salary_negotiation',
    title: 'The Raise You Can\'t Request',
    description: 'Performance reviews. Your team lead hints that top performers get significant raises. But your H-1B has a listed salary. Changing it requires paperwork.',
    sceneType: 'work',
    timing: { type: 'random', earliestMonth: 12, latestMonth: 48 },
    conditions: [
      { type: 'character', target: 'id', operator: '==', value: 'david' },
    ],
    weight: 50,
    characterIds: ['david'],
    choices: [
      {
        id: 'ask_for_raise',
        text: 'Ask for the raise anyway',
        outcomes: [
          { type: 'flag-set', target: 'asked_for_raise', value: true },
          { type: 'stat-change', target: 'stress', value: 15 },
        ],
        outcomeText: '"I\'d need to file an amended H-1B," HR says. "It\'s possible, but..." The implied message: You\'re not worth the hassle. Your citizen colleagues get raises without paperwork.',
      },
      {
        id: 'accept_current',
        text: 'Accept the status quo',
        outcomes: [
          { type: 'stat-change', target: 'stress', value: 10 },
          { type: 'flag-increment', target: 'promotions_missed', value: 1 },
        ],
        outcomeText: 'You watch your colleague—same level, same work—get a 15% raise. You got 3% and a "we really value you." The golden handcuffs tighten.',
      },
    ],
    tags: ['career', 'money', 'frustration'],
    isRepeatable: true,
    isMandatory: false,
    priority: 4,
  },
  {
    id: 'david_startup_offer',
    title: 'The Startup Temptation',
    description: 'A recruiter reaches out. Exciting startup. Equity package. Ground floor opportunity. But they\'ve never sponsored a visa before.',
    sceneType: 'work',
    timing: { type: 'random', earliestMonth: 24, latestMonth: 72 },
    conditions: [
      { type: 'character', target: 'id', operator: '==', value: 'david' },
    ],
    weight: 40,
    characterIds: ['david'],
    choices: [
      {
        id: 'explore_offer',
        text: 'Take the meeting',
        outcomes: [
          { type: 'flag-set', target: 'explored_startup', value: true },
          { type: 'stat-change', target: 'stress', value: 15 },
        ],
        outcomeText: 'Great product. Great team. But: "We\'ve never done H-1B sponsorship. Is that complicated?" You explain the costs, the timing, the risks. Their eyes glaze over. You know how this ends.',
      },
      {
        id: 'decline_meeting',
        text: 'Decline—focus on green card first',
        outcomes: [
          { type: 'stat-change', target: 'stress', value: 5 },
          { type: 'flag-increment', target: 'opportunities_declined', value: 1 },
        ],
        outcomeText: 'You write back a polite decline. Another opportunity you can\'t take. Another door that\'s open for others but closed for you.',
        isRecommended: true,
      },
    ],
    tags: ['career', 'opportunity', 'limitation'],
    isRepeatable: true,
    isMandatory: false,
    priority: 4,
  },
  {
    id: 'david_parents_visit',
    title: 'Parents\' First Visit',
    description: 'Your parents finally get tourist visas. After 8 years in America, they\'ll see how you live. But the consulate almost denied them—"strong ties to India" is hard to prove.',
    sceneType: 'home',
    timing: { type: 'random', earliestMonth: 36, latestMonth: 84 },
    conditions: [
      { type: 'character', target: 'id', operator: '==', value: 'david' },
      { type: 'flag', target: 'parents_visited', operator: 'not-exists', value: true },
    ],
    weight: 45,
    characterIds: ['david'],
    choices: [
      {
        id: 'plan_visit',
        text: 'Plan an amazing visit',
        costs: [{ type: 'money', amount: 3000, description: 'Parents visit expenses' }],
        outcomes: [
          { type: 'finance-subtract', target: 'Parents Visit', value: 3000 },
          { type: 'flag-set', target: 'parents_visited', value: true },
          { type: 'stat-change', target: 'stress', value: -20 },
        ],
        outcomeText: 'You show them everything. Your apartment. Your office. The Golden Gate Bridge. Your mother cries at how well you\'ve done. Your father beams. For two weeks, home comes to you.',
        isRecommended: true,
      },
    ],
    tags: ['family', 'positive', 'emotional'],
    isRepeatable: false,
    isMandatory: false,
    priority: 5,
  },
]

// Event chains for tracking
export const DAVID_CHAINS: EventChain[] = [
  {
    id: 'david_layoff_crisis',
    name: 'The Layoff Crisis',
    description: 'David faces the ultimate H-1B nightmare: losing his job and the 60-day countdown',
    eventIds: [
      'david_chain_layoff_start',
      'david_chain_layoff_wait',
      'david_chain_layoff_result',
      'david_chain_survivor_guilt',
      'david_chain_60_day_clock',
      'david_chain_job_search_progress',
      'david_chain_job_offer_decision',
      'david_chain_new_job_start',
      'david_chain_leaving_america',
    ],
    currentPosition: 0,
    isInterruptible: false,
    characterIds: ['david'],
  },
  {
    id: 'david_green_card_wait',
    name: 'The Green Card Backlog',
    description: 'David navigates the decades-long EB-2 India backlog',
    eventIds: [
      'david_chain_backlog_start',
      'david_chain_backlog_reality',
      'david_chain_alternatives_decision',
      'david_chain_eb1_outcome',
      'david_chain_canada_decision',
      'david_chain_years_pass',
      'david_chain_canada_life',
    ],
    currentPosition: 0,
    isInterruptible: true,
    characterIds: ['david'],
  },
  {
    id: 'david_priya_struggle',
    name: 'Priya\'s Struggle',
    description: 'Priya confronts the limitations of her H-4 dependent status',
    eventIds: [
      'david_chain_priya_dream_start',
      'david_chain_h4_ead_research',
      'david_chain_priya_working',
      'david_chain_priya_frustration',
    ],
    currentPosition: 0,
    isInterruptible: true,
    characterIds: ['david'],
  },
]
