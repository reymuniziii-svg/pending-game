import type { GameEvent, EventChain } from '@/types'

// ============ MARIA DACA DEEP DECISION CHAINS ============
// V2: Deep branching narratives with 4-8 event depth

export const MARIA_CHAIN_EVENTS: GameEvent[] = [
  // === CHAIN 1: THE MARRIAGE PATH (8 events deep) ===
  {
    id: 'maria_chain_marriage_start',
    title: 'The Immigration Lawyer',
    description: 'After the engagement, Miguel insists you meet with an immigration lawyer. "I just want to know our options," he says. The office smells like old paper and coffee.',
    sceneType: 'work',
    interruptPriority: 'important',
    timing: { type: 'random', earliestMonth: 24, latestMonth: 48 },
    conditions: [
      { type: 'character', target: 'id', operator: '==', value: 'maria' },
      { type: 'flag', target: 'engaged_to_miguel', operator: '==', value: true },
      { type: 'flag', target: 'lawyer_consultation_started', operator: 'not-exists', value: true },
    ],
    weight: 70,
    characterIds: ['maria'],
    chainId: 'maria_marriage_path',
    chainPosition: 1,
    isChainStart: true,
    choices: [
      {
        id: 'full_disclosure',
        text: 'Tell the lawyer everything about how you entered',
        costs: [{ type: 'money', amount: 300, description: 'Consultation fee' }],
        outcomes: [
          { type: 'finance-subtract', target: 'Lawyer Consultation', value: 300 },
          { type: 'flag-set', target: 'lawyer_consultation_started', value: true },
          { type: 'flag-set', target: 'lawyer_knows_full_story', value: true },
          { type: 'stat-change', target: 'stress', value: 20 },
        ],
        outcomeText: 'The lawyer listens carefully, taking notes. "I see. Entered without inspection in 2002. That complicates things significantly." She opens a thick binder. "Let me explain your options—and their risks."',
        nextEventId: 'maria_chain_lawyer_options',
      },
      {
        id: 'partial_disclosure',
        text: 'Be vague about the details',
        costs: [{ type: 'money', amount: 300, description: 'Consultation fee' }],
        outcomes: [
          { type: 'finance-subtract', target: 'Lawyer Consultation', value: 300 },
          { type: 'flag-set', target: 'lawyer_consultation_started', value: true },
          { type: 'flag-set', target: 'lawyer_knows_partial', value: true },
          { type: 'stat-change', target: 'stress', value: 10 },
        ],
        outcomeText: '"I\'ve been here since I was six, and I\'m engaged to a citizen." The lawyer gives you a long look. "I need the full picture to give you accurate advice. How did you enter the country?"',
        nextEventId: 'maria_chain_lawyer_pushes',
      },
    ],
    tags: ['immigration', 'legal', 'marriage', 'chain-start'],
    isRepeatable: false,
    isMandatory: false,
    priority: 7,
  },
  {
    id: 'maria_chain_lawyer_options',
    title: 'The Three Paths',
    description: 'The lawyer lays out three folders on her desk, each labeled with a different strategy. "None of these are easy," she says. "But these are your options."',
    sceneType: 'work',
    interruptPriority: 'critical',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['maria'],
    chainId: 'maria_marriage_path',
    chainPosition: 2,
    choices: [
      {
        id: 'i601a_waiver',
        text: 'The I-601A Waiver: Apply for hardship waiver before leaving',
        outcomes: [
          { type: 'flag-set', target: 'marriage_path_chosen', value: 'i601a' },
          { type: 'stat-change', target: 'stress', value: 15 },
        ],
        outcomeText: '"This is the safest path," she explains. "You prove your spouse would face extreme hardship if you\'re barred from the US. If approved, you go to a consular interview in Mexico, and if that goes well, you come back legally." She pauses. "The hardship standard is high. The wait is 12-24 months. And there\'s still risk at the interview."',
        nextEventId: 'maria_chain_i601a_decision',
        isRecommended: true,
      },
      {
        id: 'stay_in_limbo',
        text: 'Stay with DACA: Wait for policy changes',
        outcomes: [
          { type: 'flag-set', target: 'marriage_path_chosen', value: 'wait' },
          { type: 'stat-change', target: 'stress', value: 5 },
        ],
        outcomeText: '"Many couples choose this," she says. "DACA lets you work and live normally. The risk is that DACA could end at any time. You\'d have no backup." She closes that folder. "This is indefinite uncertainty."',
        nextEventId: 'maria_chain_wait_life',
      },
      {
        id: 'consular_risk',
        text: 'Direct Consular Processing: Go to Mexico now',
        outcomes: [
          { type: 'flag-set', target: 'marriage_path_chosen', value: 'direct_consular' },
          { type: 'stat-change', target: 'stress', value: 30 },
        ],
        outcomeText: '"This is the risky path," she warns. "You\'d go to Mexico for a consular interview without an approved waiver. If they deny you, you\'re stuck outside the US for 10 years. Maybe forever. I don\'t recommend this."',
        nextEventId: 'maria_chain_consular_research',
        isDangerous: true,
      },
    ],
    tags: ['immigration', 'legal', 'decision', 'critical'],
    isRepeatable: false,
    isMandatory: false,
    priority: 9,
  },
  {
    id: 'maria_chain_lawyer_pushes',
    title: 'The Lawyer Pushes',
    description: '"Maria," the lawyer says, looking at you directly. "I can\'t help you if you don\'t tell me the truth. Did you enter with a visa, or without inspection?"',
    sceneType: 'work',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['maria'],
    chainId: 'maria_marriage_path',
    chainPosition: 2,
    choices: [
      {
        id: 'admit_truth',
        text: 'Admit you crossed without papers',
        outcomes: [
          { type: 'flag-set', target: 'lawyer_knows_full_story', value: true },
          { type: 'stat-change', target: 'stress', value: 15 },
        ],
        outcomeText: 'The words come out heavy. "I was six. My parents carried me across." The lawyer nods, no judgment in her eyes. "Thank you for trusting me. Now let me explain what this means."',
        nextEventId: 'maria_chain_lawyer_options',
      },
      {
        id: 'leave_office',
        text: 'Say you need to think about it and leave',
        outcomes: [
          { type: 'flag-set', target: 'lawyer_consultation_aborted', value: true },
          { type: 'stat-change', target: 'stress', value: 25 },
          { type: 'relationship-change', target: 'miguel', value: -10 },
        ],
        outcomeText: 'You make an excuse and leave. Miguel catches up to you outside. "Maria, what happened? We need to know our options." "I know," you say. "I just... I need time."',
        nextEventId: 'maria_chain_miguel_worried',
      },
    ],
    tags: ['immigration', 'legal', 'trust'],
    isRepeatable: false,
    isMandatory: false,
    priority: 8,
  },
  {
    id: 'maria_chain_i601a_decision',
    title: 'The Hardship Question',
    description: 'To file the I-601A waiver, you need to prove Miguel would face "extreme hardship" without you. Not just emotional hardship—something more.',
    sceneType: 'home',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['maria'],
    chainId: 'maria_marriage_path',
    chainPosition: 3,
    choices: [
      {
        id: 'gather_evidence',
        text: 'Start gathering evidence of hardship',
        costs: [{ type: 'money', amount: 2500, description: 'Lawyer retainer for waiver' }],
        outcomes: [
          { type: 'finance-subtract', target: 'I-601A Lawyer Retainer', value: 2500 },
          { type: 'flag-set', target: 'i601a_started', value: true },
          { type: 'stat-change', target: 'stress', value: 10 },
        ],
        outcomeText: 'The lawyer needs everything: Miguel\'s medical records, financial statements, letters from family, psychological evaluations. "We need to paint a picture of why he can\'t function without you."',
        nextEventId: 'maria_chain_i601a_evidence',
      },
      {
        id: 'reconsider',
        text: 'The cost is too high right now',
        outcomes: [
          { type: 'flag-set', target: 'i601a_delayed', value: true },
          { type: 'stat-change', target: 'stress', value: 15 },
        ],
        outcomeText: '$2,500 just to start. Then filing fees. Then travel. Then uncertainty. You tell Miguel you need to save more first. He nods, but his eyes hold questions.',
        nextEventId: 'maria_chain_financial_pressure',
      },
    ],
    tags: ['immigration', 'forms', 'money', 'decision'],
    isRepeatable: false,
    isMandatory: false,
    priority: 7,
  },
  {
    id: 'maria_chain_i601a_evidence',
    title: 'Building the Case',
    description: 'For weeks, you and Miguel compile evidence. Medical records showing his anxiety. Letters from his employer about how he\'d struggle without you. A psychologist\'s evaluation.',
    sceneType: 'home',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['maria'],
    chainId: 'maria_marriage_path',
    chainPosition: 4,
    choices: [
      {
        id: 'include_mental_health',
        text: 'Include Miguel\'s history of depression',
        outcomes: [
          { type: 'flag-set', target: 'evidence_includes_mental_health', value: true },
          { type: 'stat-change', target: 'stress', value: -5 },
          { type: 'relationship-change', target: 'miguel', value: -5 },
        ],
        outcomeText: 'Miguel is reluctant to share his mental health records. "It feels like we\'re saying I\'m weak," he says. "We\'re saying you need me," you reply. "Because you do." He signs the release.',
        nextEventId: 'maria_chain_i601a_submit',
        isRecommended: true,
      },
      {
        id: 'focus_financial',
        text: 'Focus on financial evidence instead',
        outcomes: [
          { type: 'flag-set', target: 'evidence_financial_only', value: true },
          { type: 'stat-change', target: 'stress', value: 10 },
        ],
        outcomeText: 'You compile bank statements, tax returns, proof that losing your income would devastate the household. The lawyer looks concerned. "Financial hardship alone is rarely enough. But we can try."',
        nextEventId: 'maria_chain_i601a_submit',
      },
    ],
    tags: ['immigration', 'relationship', 'evidence'],
    isRepeatable: false,
    isMandatory: false,
    priority: 6,
  },
  {
    id: 'maria_chain_i601a_submit',
    title: 'The Filing',
    description: 'The package is ready. 200 pages of documents proving your life, your love, your hardship. The lawyer weighs it in her hands.',
    sceneType: 'uscis',
    interruptPriority: 'important',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['maria'],
    chainId: 'maria_marriage_path',
    chainPosition: 5,
    choices: [
      {
        id: 'submit_now',
        text: 'Submit the I-601A waiver',
        costs: [{ type: 'money', amount: 630, description: 'I-601A filing fee' }],
        outcomes: [
          { type: 'finance-subtract', target: 'I-601A Filing Fee', value: 630 },
          { type: 'flag-set', target: 'i601a_submitted', value: true },
          { type: 'stat-change', target: 'stress', value: 25 },
          { type: 'file-application', target: 'i-601a', value: true },
        ],
        outcomeText: 'You watch the lawyer put the package in the overnight envelope. "Now we wait," she says. "12 to 24 months, usually. I\'ll call you the moment we hear anything."',
        nextEventId: 'maria_chain_i601a_wait_1',
      },
      {
        id: 'delay_submit',
        text: 'Wait—you want to review everything one more time',
        outcomes: [
          { type: 'flag-set', target: 'i601a_delayed_review', value: true },
          { type: 'stat-change', target: 'stress', value: 10 },
        ],
        outcomeText: 'You take the package home. Read every page again. Look for errors. Find none. But still you wait. The next day. The day after. The lawyer calls to ask if you\'re ready.',
        nextEventId: 'maria_chain_submit_anxiety',
      },
    ],
    tags: ['immigration', 'forms', 'uscis', 'critical'],
    isRepeatable: false,
    isMandatory: false,
    priority: 8,
  },
  {
    id: 'maria_chain_i601a_wait_1',
    title: 'The Long Wait Begins',
    description: 'Three months pass. Then six. Every time the phone rings, your heart stops. Every piece of mail gets examined before opening.',
    sceneType: 'home',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['maria'],
    chainId: 'maria_marriage_path',
    chainPosition: 6,
    choices: [
      {
        id: 'check_case_obsessively',
        text: 'Check the USCIS case status daily',
        outcomes: [
          { type: 'stat-change', target: 'stress', value: 20 },
          { type: 'flag-set', target: 'case_checking_obsessive', value: true },
        ],
        outcomeText: 'Every morning. "Case Status: Pending." Every afternoon. "Case Status: Pending." The page never changes, but you can\'t stop looking. Miguel finds you refreshing it at 2 AM.',
        nextEventId: 'maria_chain_i601a_rfe_or_decision',
      },
      {
        id: 'try_to_live_normally',
        text: 'Try to focus on daily life',
        outcomes: [
          { type: 'stat-change', target: 'stress', value: 5 },
          { type: 'flag-set', target: 'case_checking_moderate', value: true },
        ],
        outcomeText: 'You check once a week. You teach your classes. You have dinner with Miguel. You pretend life is normal. But underneath, the waiting is always there. A background hum of uncertainty.',
        nextEventId: 'maria_chain_i601a_rfe_or_decision',
        isRecommended: true,
      },
    ],
    tags: ['immigration', 'waiting', 'stress', 'life'],
    isRepeatable: false,
    isMandatory: false,
    priority: 5,
  },
  {
    id: 'maria_chain_i601a_rfe_or_decision',
    title: 'The Envelope',
    description: 'Fifteen months after filing. The lawyer calls. "Maria, we got a response from USCIS."',
    sceneType: 'home',
    interruptPriority: 'critical',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['maria'],
    chainId: 'maria_marriage_path',
    chainPosition: 7,
    variants: [
      {
        condition: { type: 'flag', target: 'evidence_includes_mental_health', operator: '==', value: true },
        descriptionOverride: 'Fifteen months after filing. The lawyer calls, her voice carefully neutral. "Maria, we got a response. It\'s good news."',
      },
      {
        condition: { type: 'flag', target: 'evidence_financial_only', operator: '==', value: true },
        descriptionOverride: 'Fifteen months after filing. The lawyer calls. "Maria, we got a response. It\'s an RFE—a Request for Evidence. They want more documentation of hardship."',
      },
    ],
    choices: [
      {
        id: 'open_response',
        text: 'What does it say?',
        requirements: [{ type: 'flag', target: 'evidence_includes_mental_health', operator: '==', value: true }],
        outcomes: [
          { type: 'flag-set', target: 'i601a_approved', value: true },
          { type: 'stat-change', target: 'stress', value: -30 },
        ],
        outcomeText: '"Approved." The word echoes. "Your waiver is approved. Now we schedule your consular interview in Mexico. Maria—you\'re almost there."',
        nextEventId: 'maria_chain_consular_interview',
      },
      {
        id: 'open_rfe',
        text: 'What do they need?',
        requirements: [{ type: 'flag', target: 'evidence_financial_only', operator: '==', value: true }],
        outcomes: [
          { type: 'flag-set', target: 'i601a_rfe_received', value: true },
          { type: 'stat-change', target: 'stress', value: 30 },
        ],
        outcomeText: '"They don\'t think we\'ve proven extreme hardship. They want more evidence—psychological evaluations, medical records, anything showing emotional or physical impact on Miguel."',
        nextEventId: 'maria_chain_rfe_response',
      },
    ],
    tags: ['immigration', 'uscis', 'decision', 'critical'],
    isRepeatable: false,
    isMandatory: false,
    priority: 10,
  },
  {
    id: 'maria_chain_consular_interview',
    title: 'The Journey Home',
    description: 'With your approved waiver in hand, you book a flight to Mexico City for your consular interview. You haven\'t set foot in Mexico in 22 years.',
    sceneType: 'airport',
    interruptPriority: 'critical',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['maria'],
    chainId: 'maria_marriage_path',
    chainPosition: 8,
    choices: [
      {
        id: 'go_alone',
        text: 'Go to Mexico alone',
        costs: [{ type: 'money', amount: 1200, description: 'Flight and interview fees' }],
        outcomes: [
          { type: 'finance-subtract', target: 'Consular Interview Trip', value: 1200 },
          { type: 'flag-set', target: 'traveled_to_mexico', value: true },
          { type: 'stat-change', target: 'stress', value: 30 },
        ],
        outcomeText: 'At the airport, you hold Miguel for a long time. "I\'ll be back," you say. Neither of you mentions the alternative. On the plane, you watch America disappear below the clouds.',
        nextEventId: 'maria_chain_final_interview',
      },
      {
        id: 'miguel_comes',
        text: 'Miguel insists on coming with you',
        costs: [{ type: 'money', amount: 2000, description: 'Two flights and interview fees' }],
        outcomes: [
          { type: 'finance-subtract', target: 'Consular Interview Trip (Both)', value: 2000 },
          { type: 'flag-set', target: 'traveled_to_mexico', value: true },
          { type: 'flag-set', target: 'miguel_at_interview', value: true },
          { type: 'stat-change', target: 'stress', value: 20 },
          { type: 'relationship-change', target: 'miguel', value: 10 },
        ],
        outcomeText: '"I\'m not letting you do this alone." Miguel books his own ticket. On the flight, he holds your hand over the armrest. Your mother will finally meet him—whatever happens next.',
        nextEventId: 'maria_chain_final_interview',
        isRecommended: true,
      },
    ],
    tags: ['immigration', 'travel', 'mexico', 'critical'],
    isRepeatable: false,
    isMandatory: false,
    priority: 10,
  },
  {
    id: 'maria_chain_final_interview',
    title: 'The Interview',
    description: 'The US Consulate in Mexico City. The waiting room is full of others like you—hopeful, terrified, lives hanging on a stranger\'s decision.',
    sceneType: 'uscis',
    interruptPriority: 'critical',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['maria'],
    chainId: 'maria_marriage_path',
    chainPosition: 9,
    choices: [
      {
        id: 'present_case',
        text: 'Present your case clearly and calmly',
        outcomes: [
          { type: 'flag-set', target: 'interview_calm', value: true },
        ],
        outcomeText: 'You answer every question. Why you came. Why you stayed. Why you want to return. The officer\'s face is unreadable. "We\'ll have a decision for you in 24-48 hours. Don\'t leave the country until you hear from us."',
        nextEventId: 'maria_chain_interview_result',
        isRecommended: true,
      },
      {
        id: 'break_down',
        text: 'The pressure overwhelms you',
        outcomes: [
          { type: 'flag-set', target: 'interview_emotional', value: true },
          { type: 'stat-change', target: 'stress', value: 20 },
        ],
        outcomeText: 'Halfway through, tears start falling. 22 years of fear and hope and uncertainty pour out. The officer waits, not unkindly. "Take your time." When you finish, she says, "We\'ll be in touch."',
        nextEventId: 'maria_chain_interview_result',
      },
    ],
    tags: ['immigration', 'interview', 'critical', 'climax'],
    isRepeatable: false,
    isMandatory: false,
    priority: 10,
  },
  {
    id: 'maria_chain_interview_result',
    title: 'The Call',
    description: 'You sit in your mother\'s house in Mexico, the first time you\'ve been here in 22 years, waiting for the call that will determine everything.',
    sceneType: 'home',
    interruptPriority: 'critical',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['maria'],
    chainId: 'maria_marriage_path',
    chainPosition: 10,
    variants: [
      {
        condition: { type: 'flag', target: 'evidence_includes_mental_health', operator: '==', value: true },
        titleOverride: 'The Call: Approved',
        descriptionOverride: 'Your phone rings. A consulate number. Your hands shake so badly you almost drop it.',
      },
    ],
    choices: [
      {
        id: 'answer_approved',
        text: 'Answer the phone',
        requirements: [{ type: 'flag', target: 'evidence_includes_mental_health', operator: '==', value: true }],
        outcomes: [
          { type: 'status-change', target: 'i485-pending', value: true },
          { type: 'flag-set', target: 'consular_approved', value: true },
          { type: 'flag-set', target: 'can_return_to_us', value: true },
          { type: 'stat-change', target: 'stress', value: -50 },
          { type: 'stat-change', target: 'health', value: 10 },
        ],
        outcomeText: '"Ms. Santos? Your immigrant visa has been approved. Please come pick up your passport with the visa stamp." You collapse into a chair. Your mother is crying. Miguel is crying. After 22 years, you\'re going home. Legally.',
      },
      {
        id: 'answer_denied',
        text: 'Answer the phone',
        requirements: [{ type: 'flag', target: 'evidence_financial_only', operator: '==', value: true }],
        outcomes: [
          { type: 'flag-set', target: 'consular_denied', value: true },
          { type: 'flag-set', target: 'stuck_in_mexico', value: true },
          { type: 'stat-change', target: 'stress', value: 50 },
          { type: 'stat-change', target: 'health', value: -20 },
        ],
        outcomeText: '"Ms. Santos? I\'m sorry to inform you that your application has been denied. You are subject to a 10-year bar from entering the United States." The phone falls from your hand. Your mother holds you as you realize—this is where you live now.',
        isDangerous: true,
      },
    ],
    tags: ['immigration', 'ending', 'critical', 'climax'],
    isRepeatable: false,
    isMandatory: false,
    priority: 10,
  },

  // === CHAIN 2: THE FAMILY EMERGENCY (5 events deep) ===
  {
    id: 'maria_chain_family_emergency_start',
    title: 'The Worst Call',
    description: 'Your phone rings at 3 AM. It\'s your sister in Mexico. "Maria... it\'s Papá. He had a stroke. They don\'t know if..."',
    sceneType: 'home',
    interruptPriority: 'critical',
    timing: { type: 'random', earliestMonth: 36, latestMonth: 96 },
    conditions: [
      { type: 'character', target: 'id', operator: '==', value: 'maria' },
      { type: 'flag', target: 'father_emergency_happened', operator: 'not-exists', value: true },
    ],
    weight: 30,
    characterIds: ['maria'],
    chainId: 'maria_family_emergency',
    chainPosition: 1,
    isChainStart: true,
    choices: [
      {
        id: 'stay_in_us',
        text: 'You can\'t go. You know the consequences.',
        outcomes: [
          { type: 'flag-set', target: 'father_emergency_happened', value: true },
          { type: 'flag-set', target: 'stayed_during_emergency', value: true },
          { type: 'stat-change', target: 'stress', value: 40 },
          { type: 'stat-change', target: 'health', value: -10 },
        ],
        outcomeText: 'You hang up and stare at the ceiling for hours. Your father could be dying, and you cannot be there. If you leave, you can\'t come back. If you stay, you might never see him again.',
        nextEventId: 'maria_chain_father_updates',
      },
      {
        id: 'consider_going',
        text: 'Maybe there\'s a way...',
        outcomes: [
          { type: 'flag-set', target: 'father_emergency_happened', value: true },
          { type: 'flag-set', target: 'considered_emergency_trip', value: true },
          { type: 'stat-change', target: 'stress', value: 50 },
        ],
        outcomeText: 'You pull up flight prices. You research humanitarian parole. You call your lawyer at 4 AM. She answers, groggy. "Maria, there\'s no mechanism for this. If you leave, the 10-year bar triggers. I\'m so sorry."',
        nextEventId: 'maria_chain_emergency_decision',
        isDangerous: true,
      },
    ],
    tags: ['family', 'emergency', 'critical', 'sacrifice'],
    isRepeatable: false,
    isMandatory: false,
    priority: 10,
  },
  {
    id: 'maria_chain_emergency_decision',
    title: 'The Impossible Choice',
    description: 'Your lawyer\'s words echo. No humanitarian parole for DACA recipients. No advance parole for emergencies. No way to say goodbye and come back.',
    sceneType: 'home',
    interruptPriority: 'critical',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['maria'],
    chainId: 'maria_family_emergency',
    chainPosition: 2,
    choices: [
      {
        id: 'stay_final',
        text: 'Stay. You have to stay.',
        outcomes: [
          { type: 'flag-set', target: 'stayed_during_emergency', value: true },
          { type: 'stat-change', target: 'stress', value: 30 },
          { type: 'flag-set', target: 'major_sacrifice_made', value: true },
        ],
        outcomeText: 'You call your sister back. "I can\'t come. Tell him I love him. Tell him..." Your voice breaks. The next days blur together. Video calls. Updates. Waiting for news from a hospital room you can\'t enter.',
        nextEventId: 'maria_chain_father_updates',
      },
      {
        id: 'go_anyway',
        text: 'Go to Mexico. Whatever the consequences.',
        outcomes: [
          { type: 'flag-set', target: 'left_for_emergency', value: true },
          { type: 'flag-set', target: 'daca_invalidated', value: true },
          { type: 'status-change', target: 'undocumented', value: true },
          { type: 'stat-change', target: 'stress', value: 20 },
        ],
        outcomeText: 'You book the flight. You hold Miguel tight. "I might not be able to come back." "I know," he says. "But you\'d never forgive yourself." At the airport, you show your DACA card for the last time.',
        nextEventId: 'maria_chain_left_for_mexico',
        isDangerous: true,
      },
    ],
    tags: ['family', 'emergency', 'critical', 'choice'],
    isRepeatable: false,
    isMandatory: false,
    priority: 10,
  },
  {
    id: 'maria_chain_father_updates',
    title: 'Updates from Mexico',
    description: 'For two weeks, your phone becomes a lifeline. Video calls from the hospital. Updates from your sister. Your father, fighting.',
    sceneType: 'home',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['maria'],
    chainId: 'maria_family_emergency',
    chainPosition: 3,
    variants: [
      {
        condition: { type: 'flag', target: 'stayed_during_emergency', operator: '==', value: true },
        descriptionOverride: 'For two weeks, your phone becomes a lifeline. You watch your father fight for his life through a six-inch screen. You can\'t hold his hand. You can\'t be there.',
      },
    ],
    choices: [
      {
        id: 'father_recovers',
        text: 'Wait for news...',
        outcomes: [
          { type: 'flag-set', target: 'father_survived', value: true },
          { type: 'stat-change', target: 'stress', value: -20 },
        ],
        outcomeText: 'Day 15. Your sister\'s face on the screen, exhausted but smiling. "He\'s going to make it, Maria. He\'s asking for you." You cry with relief. He\'s alive. And you still can\'t see him.',
        probability: 0.7,
      },
      {
        id: 'father_dies',
        text: 'Wait for news...',
        outcomes: [
          { type: 'flag-set', target: 'father_died', value: true },
          { type: 'flag-increment', target: 'missed_funerals', value: 1 },
          { type: 'stat-change', target: 'stress', value: 30 },
          { type: 'stat-change', target: 'health', value: -15 },
        ],
        outcomeText: 'Day 12. Your sister\'s face, broken. "Maria... he\'s gone. He said your name at the end." The funeral is in three days. You cannot attend. Your father will be buried, and you will watch on a phone.',
        probability: 0.3,
      },
    ],
    tags: ['family', 'emotional', 'waiting'],
    isRepeatable: false,
    isMandatory: false,
    priority: 8,
  },
  {
    id: 'maria_chain_left_for_mexico',
    title: 'Back in Mexico',
    description: 'The plane lands in Mexico City. For the first time in 22 years, you\'re standing in your birth country. As an adult. As someone who can\'t go home.',
    sceneType: 'airport',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['maria'],
    chainId: 'maria_family_emergency',
    chainPosition: 3,
    choices: [
      {
        id: 'go_to_hospital',
        text: 'Rush to the hospital',
        outcomes: [
          { type: 'flag-set', target: 'reached_father', value: true },
          { type: 'stat-change', target: 'stress', value: -15 },
        ],
        outcomeText: 'You take a taxi, your heart pounding. Through hospital corridors. Into a room where your father lies with tubes and monitors. His eyes open when you enter. "Mija," he whispers. "You came."',
        nextEventId: 'maria_chain_mexico_father_outcome',
      },
    ],
    tags: ['family', 'mexico', 'emotional'],
    isRepeatable: false,
    isMandatory: false,
    priority: 9,
  },
  {
    id: 'maria_chain_mexico_father_outcome',
    title: 'What Happens Now',
    description: 'You spend two weeks in Mexico. Your father recovers slowly. Miguel calls every day. Your students email asking when you\'ll be back. You don\'t know how to answer.',
    sceneType: 'home',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['maria'],
    chainId: 'maria_family_emergency',
    chainPosition: 4,
    choices: [
      {
        id: 'stay_in_mexico',
        text: 'Accept that this is home now',
        outcomes: [
          { type: 'flag-set', target: 'chose_mexico', value: true },
          { type: 'stat-change', target: 'stress', value: 20 },
          { type: 'stat-change', target: 'communityConnection', value: -30 },
        ],
        outcomeText: 'You look for work. You rebuild. Miguel visits when he can. Your relationship becomes video calls and occasional trips. You\'re in the country of your birth, building a life you never planned.',
        nextEventId: 'maria_ending_mexico',
      },
      {
        id: 'try_to_return',
        text: 'Explore any possible way back',
        outcomes: [
          { type: 'flag-set', target: 'seeking_return', value: true },
          { type: 'stat-change', target: 'stress', value: 25 },
        ],
        outcomeText: 'You consult with every lawyer. Research every option. The waiver process. The wait time. The uncertainty. You might be able to apply to return—in ten years, if everything goes perfectly.',
        nextEventId: 'maria_chain_long_path_back',
      },
    ],
    tags: ['life-change', 'mexico', 'decision'],
    isRepeatable: false,
    isMandatory: false,
    priority: 8,
  },

  // === CHAIN 3: POLICY CHANGE (4 events deep) ===
  {
    id: 'maria_chain_policy_threat_start',
    title: 'The News Alert',
    description: '"BREAKING: Administration announces DACA termination." Your phone lights up with notifications. Your students\' parents text you. Miguel calls. Your world tilts.',
    sceneType: 'home',
    interruptPriority: 'critical',
    timing: { type: 'random', earliestMonth: 24, latestMonth: 84 },
    conditions: [
      { type: 'character', target: 'id', operator: '==', value: 'maria' },
      { type: 'flag', target: 'daca_termination_announced', operator: 'not-exists', value: true },
    ],
    weight: 25,
    characterIds: ['maria'],
    chainId: 'maria_policy_crisis',
    chainPosition: 1,
    isChainStart: true,
    choices: [
      {
        id: 'panic',
        text: 'Panic sets in',
        outcomes: [
          { type: 'flag-set', target: 'daca_termination_announced', value: true },
          { type: 'stat-change', target: 'stress', value: 40 },
          { type: 'stat-change', target: 'health', value: -10 },
        ],
        outcomeText: 'You can\'t breathe. Your work authorization expires in four months. Without DACA, you can\'t work. Can\'t drive legally in your state. Become invisible overnight.',
        nextEventId: 'maria_chain_policy_response',
      },
      {
        id: 'organize_response',
        text: 'Channel this into action',
        outcomes: [
          { type: 'flag-set', target: 'daca_termination_announced', value: true },
          { type: 'stat-change', target: 'stress', value: 20 },
          { type: 'stat-change', target: 'communityConnection', value: 15 },
          { type: 'flag-increment', target: 'activism_count', value: 1 },
        ],
        outcomeText: 'You\'ve prepared for this moment. You call the immigrant rights hotline. Attend emergency meetings. Share resources with other Dreamers. If they\'re coming for DACA, they\'ll have to fight.',
        nextEventId: 'maria_chain_policy_fight',
        isRecommended: true,
      },
    ],
    tags: ['policy', 'daca', 'crisis', 'critical'],
    isRepeatable: false,
    isMandatory: false,
    priority: 10,
  },
  {
    id: 'maria_chain_policy_response',
    title: 'The Legal Challenges',
    description: 'Lawyers file emergency injunctions. Courts issue stays. The news becomes a constant stream of legal updates. Your status hangs on judicial decisions.',
    sceneType: 'neutral',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['maria'],
    chainId: 'maria_policy_crisis',
    chainPosition: 2,
    choices: [
      {
        id: 'renew_immediately',
        text: 'Renew DACA now, while you still can',
        costs: [{ type: 'money', amount: 495, description: 'Emergency DACA renewal' }],
        outcomes: [
          { type: 'finance-subtract', target: 'Emergency DACA Renewal', value: 495 },
          { type: 'flag-set', target: 'emergency_renewal_filed', value: true },
          { type: 'stat-change', target: 'stress', value: -10 },
        ],
        outcomeText: 'You file renewal papers immediately. If the courts uphold the program even temporarily, you want to be protected. $495 for maybe two more years. Or maybe nothing. You won\'t know for months.',
        nextEventId: 'maria_chain_policy_outcome',
      },
      {
        id: 'wait_for_courts',
        text: 'Wait to see what the courts decide',
        outcomes: [
          { type: 'flag-set', target: 'waited_on_courts', value: true },
          { type: 'stat-change', target: 'stress', value: 30 },
        ],
        outcomeText: 'You decide to wait. Watch the legal battles play out. Maybe Congress will act. Maybe the courts will block it permanently. Maybe... you\'re gambling with your future on "maybe."',
        nextEventId: 'maria_chain_policy_outcome',
      },
    ],
    tags: ['policy', 'daca', 'legal', 'decision'],
    isRepeatable: false,
    isMandatory: false,
    priority: 8,
  },
  {
    id: 'maria_chain_policy_fight',
    title: 'The Movement',
    description: 'You become part of something larger. Rallies. Press conferences. Congressional visits. Your story becomes one of thousands pushing for change.',
    sceneType: 'community',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['maria'],
    chainId: 'maria_policy_crisis',
    chainPosition: 2,
    choices: [
      {
        id: 'go_public',
        text: 'Share your story publicly',
        outcomes: [
          { type: 'flag-set', target: 'shared_story_publicly', value: true },
          { type: 'stat-change', target: 'communityConnection', value: 20 },
          { type: 'stat-change', target: 'stress', value: 15 },
        ],
        outcomeText: 'You speak at a rally. Cameras and microphones. "I came here at six years old. I\'ve been a teacher for five years. This is my home." The video goes viral. Supporters and hatred flood your inbox.',
        nextEventId: 'maria_chain_policy_outcome',
      },
      {
        id: 'support_behind_scenes',
        text: 'Work behind the scenes',
        outcomes: [
          { type: 'flag-set', target: 'activism_behind_scenes', value: true },
          { type: 'stat-change', target: 'communityConnection', value: 10 },
          { type: 'stat-change', target: 'stress', value: 5 },
        ],
        outcomeText: 'You organize phone banks. Draft letters. Support those who speak publicly. Visibility is important, but so is protecting yourself. You can\'t help anyone if you\'re targeted.',
        nextEventId: 'maria_chain_policy_outcome',
      },
    ],
    tags: ['activism', 'community', 'policy'],
    isRepeatable: false,
    isMandatory: false,
    priority: 7,
  },
  {
    id: 'maria_chain_policy_outcome',
    title: 'The Supreme Court Decision',
    description: 'Months later. The Supreme Court rules. Everyone gathers around phones and TVs, waiting for the words that will determine hundreds of thousands of lives.',
    sceneType: 'community',
    interruptPriority: 'critical',
    timing: { type: 'triggered' },
    conditions: [],
    weight: 0,
    characterIds: ['maria'],
    chainId: 'maria_policy_crisis',
    chainPosition: 3,
    choices: [
      {
        id: 'daca_saved',
        text: 'The ruling comes down...',
        outcomes: [
          { type: 'flag-set', target: 'daca_court_victory', value: true },
          { type: 'stat-change', target: 'stress', value: -30 },
        ],
        outcomeText: '"The Court holds that the termination was arbitrary and capricious." DACA survives—for now. You cry. Everyone around you cries. It\'s not permanence. But it\'s another day. Another year. Another chance.',
        probability: 0.6,
      },
      {
        id: 'daca_ended',
        text: 'The ruling comes down...',
        outcomes: [
          { type: 'flag-set', target: 'daca_court_defeat', value: true },
          { type: 'stat-change', target: 'stress', value: 40 },
          { type: 'flag-set', target: 'daca_ending_soon', value: true },
        ],
        outcomeText: '"The Court finds the termination to be within executive authority." DACA will end. A wind-down period begins. In six months, you will have no work authorization. No protection. Nothing.',
        probability: 0.4,
      },
    ],
    tags: ['policy', 'court', 'critical', 'climax'],
    isRepeatable: false,
    isMandatory: false,
    priority: 10,
  },

  // === ADDITIONAL STANDALONE EVENTS FOR MARIA (to reach 45 total) ===
  {
    id: 'maria_teaching_moment',
    title: 'The Immigration Lesson',
    description: 'A student asks during social studies: "Miss Santos, what\'s DACA?" The whole class turns to look at you.',
    sceneType: 'work',
    timing: { type: 'random', earliestMonth: 12, latestMonth: 60 },
    conditions: [
      { type: 'character', target: 'id', operator: '==', value: 'maria' },
    ],
    weight: 45,
    characterIds: ['maria'],
    choices: [
      {
        id: 'educational_answer',
        text: 'Give a factual, age-appropriate explanation',
        outcomes: [
          { type: 'stat-change', target: 'stress', value: 5 },
          { type: 'flag-increment', target: 'teaching_moments', value: 1 },
        ],
        outcomeText: '"DACA is a program that lets some people who came here as children go to school and work. Like me." The students\' eyes widen. Questions follow. You answer them honestly.',
        isRecommended: true,
      },
      {
        id: 'redirect',
        text: 'Redirect to the textbook material',
        outcomes: [
          { type: 'stat-change', target: 'stress', value: 10 },
        ],
        outcomeText: '"That\'s a great question. Let\'s look at what the book says about immigration policy." You avoid personal disclosure. Later, you wonder if you missed a teaching moment.',
      },
    ],
    tags: ['teaching', 'identity', 'daily-life'],
    isRepeatable: true,
    isMandatory: false,
    priority: 3,
  },
  {
    id: 'maria_license_renewal',
    title: 'License Renewal Day',
    description: 'Your driver\'s license is up for renewal. In your state, DACA recipients can get licenses—but it\'s always an ordeal.',
    sceneType: 'uscis',
    timing: { type: 'random', earliestMonth: 20, latestMonth: 48 },
    conditions: [
      { type: 'character', target: 'id', operator: '==', value: 'maria' },
    ],
    weight: 40,
    characterIds: ['maria'],
    choices: [
      {
        id: 'go_early',
        text: 'Arrive early with all documentation',
        costs: [{ type: 'money', amount: 40, description: 'License renewal fee' }],
        outcomes: [
          { type: 'finance-subtract', target: 'License Renewal', value: 40 },
          { type: 'stat-change', target: 'stress', value: 15 },
        ],
        outcomeText: 'Four hours at the DMV. The clerk doesn\'t know how to process your DACA card. A supervisor is called. Forms are consulted. Finally: "Next!" You walk out with a license that expires with your DACA.',
      },
      {
        id: 'bring_lawyer_letter',
        text: 'Bring a letter from your lawyer explaining DACA',
        costs: [{ type: 'money', amount: 90, description: 'License fee plus lawyer letter' }],
        outcomes: [
          { type: 'finance-subtract', target: 'License with Letter', value: 90 },
          { type: 'stat-change', target: 'stress', value: 5 },
        ],
        outcomeText: 'The letter works. The clerk reads it, nods, processes your renewal in twenty minutes. $50 for convenience and dignity. Sometimes that\'s what you pay.',
        isRecommended: true,
      },
    ],
    tags: ['daily-life', 'bureaucracy', 'documentation'],
    isRepeatable: true,
    isMandatory: false,
    priority: 2,
  },
  {
    id: 'maria_background_check',
    title: 'The Background Check',
    description: 'The school district is running updated background checks on all teachers. Routine, they say. Your heart still races.',
    sceneType: 'work',
    timing: { type: 'random', earliestMonth: 24, latestMonth: 72 },
    conditions: [
      { type: 'character', target: 'id', operator: '==', value: 'maria' },
    ],
    weight: 35,
    characterIds: ['maria'],
    choices: [
      {
        id: 'submit_normally',
        text: 'Submit the required documents',
        outcomes: [
          { type: 'stat-change', target: 'stress', value: 20 },
        ],
        outcomeText: 'You fill out the forms. Provide your DACA card and EAD. Wait. Two weeks later, you\'re cleared. You knew you would be. The anxiety doesn\'t care about logic.',
      },
      {
        id: 'talk_to_admin',
        text: 'Talk to administration about your concerns',
        outcomes: [
          { type: 'stat-change', target: 'stress', value: 10 },
          { type: 'flag-set', target: 'admin_knows_status', value: true },
        ],
        outcomeText: 'The principal nods understanding. "We value you, Maria. Your status doesn\'t change that." You\'re not sure if it helps, but someone with power knows and supports you.',
        isRecommended: true,
      },
    ],
    tags: ['work', 'documentation', 'anxiety'],
    isRepeatable: false,
    isMandatory: false,
    priority: 4,
  },
  {
    id: 'maria_tax_time',
    title: 'Tax Season',
    description: 'It\'s April. Time to file taxes. You have an ITIN from before DACA and a Social Security number from after. Two numbers, one person, complicated forms.',
    sceneType: 'home',
    timing: { type: 'random', earliestMonth: 3, latestMonth: 15 },
    conditions: [
      { type: 'character', target: 'id', operator: '==', value: 'maria' },
    ],
    weight: 50,
    characterIds: ['maria'],
    choices: [
      {
        id: 'professional_help',
        text: 'Hire an accountant who understands DACA cases',
        costs: [{ type: 'money', amount: 200, description: 'Tax preparation' }],
        outcomes: [
          { type: 'finance-subtract', target: 'Tax Preparation', value: 200 },
          { type: 'stat-change', target: 'stress', value: -5 },
        ],
        outcomeText: 'The accountant has seen it all. ITIN to SSN transitions, amended returns, the whole complicated dance. It\'s expensive, but your taxes are filed correctly.',
        isRecommended: true,
      },
      {
        id: 'diy_taxes',
        text: 'Try to file yourself',
        outcomes: [
          { type: 'stat-change', target: 'stress', value: 15 },
        ],
        outcomeText: 'TurboTax doesn\'t handle your situation well. You spend hours researching. The IRS website is unclear. Eventually, you file, hoping you did it right.',
      },
    ],
    tags: ['finances', 'taxes', 'bureaucracy'],
    isRepeatable: true,
    isMandatory: false,
    priority: 2,
  },
  {
    id: 'maria_parent_conference',
    title: 'Parent Conference',
    description: 'Parent-teacher conferences tonight. One parent has made comments before about "illegals." Their child is in your class.',
    sceneType: 'work',
    timing: { type: 'random', earliestMonth: 9, latestMonth: 48 },
    conditions: [
      { type: 'character', target: 'id', operator: '==', value: 'maria' },
    ],
    weight: 40,
    characterIds: ['maria'],
    choices: [
      {
        id: 'professional',
        text: 'Stay professional. Focus on the child.',
        outcomes: [
          { type: 'stat-change', target: 'stress', value: 20 },
        ],
        outcomeText: 'You discuss grades, behavior, potential. Keep it clinical. The parent seems surprised by your competence. Later, you hear they told someone, "She\'s actually a good teacher." Progress?',
        isRecommended: true,
      },
      {
        id: 'avoid',
        text: 'Ask a colleague to cover for you',
        outcomes: [
          { type: 'stat-change', target: 'stress', value: 10 },
          { type: 'flag-increment', target: 'confrontations_avoided', value: 1 },
        ],
        outcomeText: 'A fellow teacher takes the conference. You feel relief and shame in equal measure. Self-preservation isn\'t cowardice. But it doesn\'t feel like courage either.',
      },
    ],
    tags: ['work', 'social', 'discrimination'],
    isRepeatable: true,
    isMandatory: false,
    priority: 3,
  },
  {
    id: 'maria_mortgage_question',
    title: 'The Mortgage Question',
    description: 'You and Miguel want to buy a house. The loan officer asks for documentation. "What type of work authorization is this?"',
    sceneType: 'work',
    timing: { type: 'random', earliestMonth: 36, latestMonth: 72 },
    conditions: [
      { type: 'character', target: 'id', operator: '==', value: 'maria' },
      { type: 'flag', target: 'engaged_to_miguel', operator: '==', value: true },
    ],
    weight: 35,
    characterIds: ['maria'],
    choices: [
      {
        id: 'explain_daca',
        text: 'Explain DACA and your work history',
        outcomes: [
          { type: 'stat-change', target: 'stress', value: 20 },
          { type: 'flag-set', target: 'tried_for_mortgage', value: true },
        ],
        outcomeText: 'The loan officer types notes. Consults a supervisor. "We can only approve you for a loan term shorter than your work authorization. Two years max." A house with a two-year mortgage. Impossible.',
      },
      {
        id: 'miguel_only',
        text: 'Have Miguel apply alone',
        outcomes: [
          { type: 'stat-change', target: 'stress', value: 15 },
          { type: 'relationship-change', target: 'miguel', value: -5 },
        ],
        outcomeText: '"It\'ll just be in my name for now," Miguel says. "We\'ll fix it later." Another thing you can\'t have in your own name. Another part of life where you\'re invisible.',
      },
    ],
    tags: ['finances', 'housing', 'relationship', 'bureaucracy'],
    isRepeatable: false,
    isMandatory: false,
    priority: 4,
  },
]

// Event chains for tracking
export const MARIA_CHAINS: EventChain[] = [
  {
    id: 'maria_marriage_path',
    name: 'The Path to Marriage',
    description: 'Maria navigates the complex legal path of trying to adjust status through marriage',
    eventIds: [
      'maria_chain_marriage_start',
      'maria_chain_lawyer_options',
      'maria_chain_lawyer_pushes',
      'maria_chain_i601a_decision',
      'maria_chain_i601a_evidence',
      'maria_chain_i601a_submit',
      'maria_chain_i601a_wait_1',
      'maria_chain_i601a_rfe_or_decision',
      'maria_chain_consular_interview',
      'maria_chain_final_interview',
      'maria_chain_interview_result',
    ],
    currentPosition: 0,
    isInterruptible: false,
    requiredFlags: ['engaged_to_miguel'],
    characterIds: ['maria'],
  },
  {
    id: 'maria_family_emergency',
    name: 'The Family Emergency',
    description: 'A medical emergency forces Maria to confront the impossible choice',
    eventIds: [
      'maria_chain_family_emergency_start',
      'maria_chain_emergency_decision',
      'maria_chain_father_updates',
      'maria_chain_left_for_mexico',
      'maria_chain_mexico_father_outcome',
    ],
    currentPosition: 0,
    isInterruptible: false,
    characterIds: ['maria'],
  },
  {
    id: 'maria_policy_crisis',
    name: 'The Policy Crisis',
    description: 'DACA faces termination and Maria must decide how to respond',
    eventIds: [
      'maria_chain_policy_threat_start',
      'maria_chain_policy_response',
      'maria_chain_policy_fight',
      'maria_chain_policy_outcome',
    ],
    currentPosition: 0,
    isInterruptible: true,
    characterIds: ['maria'],
  },
]
